<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moving Cost Calculator - Get Your Free Quote</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
/* ============================================
   MOVING COST CALCULATOR - STYLES
   Mobile-first responsive design with dark mode
   ============================================ */

:root {
    /* Light Mode Colors */
    --primary-color: #3b82f6;
    --secondary-color: #10b981;
    --accent-color: #f59e0b;
    --danger-color: #ef4444;

    --bg-primary: #ffffff;
    --bg-secondary: #f9fafb;
    --bg-tertiary: #f3f4f6;

    --text-primary: #111827;
    --text-secondary: #6b7280;
    --text-tertiary: #9ca3af;

    --border-color: #e5e7eb;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);

    --radius-sm: 6px;
    --radius-md: 12px;
    --radius-lg: 16px;

    --transition: all 0.3s ease;
}

/* Dark Mode */
body.dark-mode {
    --bg-primary: #111827;
    --bg-secondary: #1f2937;
    --bg-tertiary: #374151;

    --text-primary: #f9fafb;
    --text-secondary: #d1d5db;
    --text-tertiary: #9ca3af;

    --border-color: #374151;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.5);
}

/* ============================================
   BASE STYLES
   ============================================ */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background: var(--bg-secondary);
    color: var(--text-primary);
    line-height: 1.6;
    transition: var(--transition);
    min-height: 100vh;
    padding: 20px 10px;
}

.container {
    max-width: 900px;
    margin: 0 auto;
    background: var(--bg-primary);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    padding: 20px;
    transition: var(--transition);
}

/* ============================================
   DARK MODE TOGGLE
   ============================================ */

.dark-mode-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 2px solid var(--border-color);
    background: var(--bg-primary);
    cursor: pointer;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-md);
    transition: var(--transition);
    z-index: 1000;
}

.dark-mode-toggle:hover {
    transform: scale(1.1);
    box-shadow: var(--shadow-lg);
}

.dark-mode-toggle .icon-moon {
    display: none;
}

body.dark-mode .dark-mode-toggle .icon-sun {
    display: none;
}

body.dark-mode .dark-mode-toggle .icon-moon {
    display: inline;
}

/* ============================================
   HEADER
   ============================================ */

.header {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
}

.header h1 {
    font-size: 2rem;
    color: var(--primary-color);
    margin-bottom: 8px;
}

.subtitle {
    color: var(--text-secondary);
    font-size: 1rem;
}

/* ============================================
   MODE SWITCHER
   ============================================ */

.mode-switcher {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
    background: var(--bg-tertiary);
    padding: 6px;
    border-radius: var(--radius-md);
}

.mode-btn {
    flex: 1;
    padding: 12px 20px;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    font-size: 1rem;
    font-weight: 600;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: var(--transition);
}

.mode-btn.active {
    background: var(--bg-primary);
    color: var(--primary-color);
    box-shadow: var(--shadow-sm);
}

.mode-btn:hover:not(.active) {
    color: var(--text-primary);
}

/* ============================================
   PROGRESS BAR
   ============================================ */

.progress-bar {
    height: 8px;
    background: var(--bg-tertiary);
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 10px;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    width: 33%;
    transition: width 0.5s ease;
    border-radius: 10px;
}

.progress-text {
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 30px;
}

/* ============================================
   MODE CONTENT
   ============================================ */

.mode-content {
    display: none;
}

.mode-content.active {
    display: block;
}

/* ============================================
   INVENTORY SUMMARY BAR
   ============================================ */

.inventory-summary {
    display: flex;
    justify-content: space-around;
    gap: 15px;
    padding: 20px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-md);
    margin-bottom: 30px;
}

.summary-item {
    text-align: center;
}

.summary-label {
    display: block;
    color: var(--text-secondary);
    font-size: 0.85rem;
    margin-bottom: 5px;
}

.summary-value {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
}

/* ============================================
   INVENTORY CATEGORIES
   ============================================ */

.inventory-category {
    margin-bottom: 25px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    overflow: hidden;
}

.category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: var(--bg-tertiary);
    cursor: pointer;
    transition: var(--transition);
}

.category-header:hover {
    background: var(--bg-secondary);
}

.category-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
}

.category-toggle {
    font-size: 1.2rem;
    transition: transform 0.3s ease;
}

.category-header.active .category-toggle {
    transform: rotate(180deg);
}

.category-items {
    display: none;
    padding: 20px;
    background: var(--bg-primary);
}

.category-items.active {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
}

.inventory-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-sm);
    background: var(--bg-secondary);
    transition: var(--transition);
}

.inventory-item:hover {
    border-color: var(--primary-color);
    transform: translateY(-2px);
}

.item-icon {
    font-size: 1.8rem;
}

.item-info {
    flex: 1;
}

.item-name {
    display: block;
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--text-primary);
}

.item-weight {
    display: block;
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.item-controls {
    display: flex;
    align-items: center;
    gap: 8px;
}

.item-btn {
    width: 30px;
    height: 30px;
    border: none;
    border-radius: 50%;
    background: var(--primary-color);
    color: white;
    font-size: 1.1rem;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
}

.item-btn:hover {
    transform: scale(1.1);
    box-shadow: var(--shadow-md);
}

.item-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.item-count {
    font-weight: 700;
    font-size: 1rem;
    min-width: 25px;
    text-align: center;
    color: var(--primary-color);
}

/* ============================================
   AI INPUT SECTION
   ============================================ */

.ai-input-section {
    max-width: 600px;
    margin: 0 auto;
}

.ai-input-section h2 {
    font-size: 1.5rem;
    margin-bottom: 10px;
    color: var(--primary-color);
}

.ai-hint {
    color: var(--text-secondary);
    margin-bottom: 20px;
}

.ai-textarea {
    width: 100%;
    padding: 15px;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-size: 1rem;
    font-family: inherit;
    resize: vertical;
    transition: var(--transition);
}

.ai-textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.ai-parsed-results {
    margin-top: 25px;
    padding: 20px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-md);
    border-left: 4px solid var(--secondary-color);
}

.ai-parsed-results h3 {
    margin-bottom: 15px;
    color: var(--secondary-color);
}

#aiDetectedList {
    list-style: none;
    margin-bottom: 15px;
}

#aiDetectedList li {
    padding: 8px 0;
    border-bottom: 1px solid var(--border-color);
}

#aiDetectedList li:last-child {
    border-bottom: none;
}

.ai-confidence {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-style: italic;
}

/* ============================================
   MOVE DETAILS FORM
   ============================================ */

.move-details-section {
    margin-top: 40px;
    padding-top: 30px;
    border-top: 2px solid var(--border-color);
}

.move-details-section h2 {
    font-size: 1.5rem;
    margin-bottom: 25px;
    color: var(--primary-color);
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text-primary);
}

.form-group input,
.form-group select {
    padding: 12px;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-sm);
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-size: 1rem;
    transition: var(--transition);
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-group small {
    margin-top: 5px;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.form-group input[type="checkbox"] {
    width: auto;
    margin-right: 8px;
}

/* ============================================
   BUTTONS
   ============================================ */

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-sm);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-primary {
    background: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background: #2563eb;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.btn-secondary {
    background: var(--secondary-color);
    color: white;
}

.btn-secondary:hover {
    background: #059669;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.btn-outline {
    background: transparent;
    border: 2px solid var(--primary-color);
    color: var(--primary-color);
}

.btn-outline:hover {
    background: var(--primary-color);
    color: white;
}

.btn-large {
    width: 100%;
    padding: 16px 24px;
    font-size: 1.1rem;
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* ============================================
   RESULTS SECTIONS
   ============================================ */

.results-section {
    margin-top: 40px;
    padding-top: 30px;
    border-top: 2px solid var(--border-color);
}

.results-hero {
    text-align: center;
    margin-bottom: 40px;
}

.results-hero h2 {
    font-size: 1.8rem;
    margin-bottom: 20px;
    color: var(--primary-color);
}

.cost-range {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
}

.cost-amount {
    text-align: center;
}

.cost-label {
    display: block;
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin-bottom: 8px;
}

.cost-value {
    display: block;
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--secondary-color);
}

.cost-divider {
    font-size: 2rem;
    color: var(--text-tertiary);
}

/* Quick Facts */

.quick-facts {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.fact-item {
    text-align: center;
    padding: 20px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-md);
}

.fact-icon {
    font-size: 2rem;
    display: block;
    margin-bottom: 10px;
}

.fact-label {
    display: block;
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-bottom: 5px;
}

.fact-value {
    display: block;
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--primary-color);
}

/* Lead Capture */

.lead-capture {
    max-width: 500px;
    margin: 0 auto;
    padding: 30px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
    text-align: center;
}

.lead-capture h3 {
    font-size: 1.5rem;
    margin-bottom: 10px;
    color: var(--primary-color);
}

.lead-capture p {
    color: var(--text-secondary);
    margin-bottom: 25px;
}

.lead-form .form-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
    margin-bottom: 15px;
}

.lead-form input {
    padding: 14px;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-sm);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 1rem;
}

.lead-form input:focus {
    outline: none;
    border-color: var(--primary-color);
}

/* Full Results */

.results-header {
    text-align: center;
    margin-bottom: 30px;
}

.results-header h2 {
    font-size: 1.8rem;
    color: var(--primary-color);
    margin-bottom: 10px;
}

.customer-name {
    color: var(--text-secondary);
    font-size: 1rem;
}

.customer-name span {
    font-weight: 700;
    color: var(--text-primary);
}

.cost-summary {
    text-align: center;
    padding: 30px;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    border-radius: var(--radius-lg);
    margin-bottom: 30px;
    color: white;
}

.cost-summary h3 {
    margin-bottom: 15px;
    opacity: 0.9;
}

.cost-range-large {
    font-size: 2.5rem;
    font-weight: 700;
}

/* Breakdown Table */

.breakdown-section {
    margin-bottom: 30px;
}

.breakdown-section h3 {
    font-size: 1.3rem;
    margin-bottom: 15px;
    color: var(--primary-color);
}

.breakdown-table {
    width: 100%;
    border-collapse: collapse;
    border-radius: var(--radius-md);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
}

.breakdown-table th {
    background: var(--bg-tertiary);
    padding: 15px;
    text-align: left;
    font-weight: 600;
    color: var(--text-primary);
}

.breakdown-table td {
    padding: 12px 15px;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-primary);
}

.breakdown-table tr:last-child td {
    border-bottom: none;
}

.breakdown-table tr:hover {
    background: var(--bg-secondary);
}

/* Move Summary */

.move-summary {
    padding: 20px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-md);
    margin-bottom: 30px;
}

.move-summary h3 {
    font-size: 1.3rem;
    margin-bottom: 15px;
    color: var(--primary-color);
}

/* Action Buttons */

.action-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
}

.btn-book-now {
    font-size: 1.1rem;
    font-weight: 700;
    padding: 18px 35px;
    background: linear-gradient(135deg, var(--primary-color), #2563eb);
    animation: pulse 2s infinite;
}

.btn-call-office {
    background: var(--secondary-color);
    font-weight: 600;
}

.btn-success {
    background: var(--secondary-color);
    color: white;
}

.btn-success:hover {
    background: #059669;
}

/* ============================================
   MOVE RISK SCORE
   ============================================ */

.risk-score-badge {
    background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
    border-radius: var(--radius-lg);
    padding: 20px;
    margin: 20px 0;
}

.risk-score-content {
    display: flex;
    align-items: center;
    gap: 15px;
}

.risk-icon {
    font-size: 2.5rem;
}

.risk-info {
    flex: 1;
}

.risk-label {
    display: block;
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 5px;
}

.risk-message {
    display: block;
    font-size: 0.95rem;
    color: var(--text-secondary);
}

/* ============================================
   AI SUMMARY SECTION
   ============================================ */

.ai-summary-section {
    background: linear-gradient(135deg, #eff6ff, #dbeafe);
    border-left: 4px solid var(--primary-color);
    border-radius: var(--radius-md);
    padding: 25px;
    margin: 25px 0;
}

.dark-mode .ai-summary-section {
    background: linear-gradient(135deg, #1e3a8a, #1e40af);
}

.ai-summary-section h3 {
    margin: 0 0 15px 0;
    color: var(--primary-color);
}

.ai-summary-text {
    font-size: 1.05rem;
    line-height: 1.7;
    color: var(--text-primary);
    margin: 0;
}

.ai-summary-full {
    margin: 25px 0;
}

.summary-card {
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
    padding: 30px;
    border: 2px solid var(--border-color);
}

.summary-card h3 {
    margin: 0 0 15px 0;
    color: var(--primary-color);
}

.summary-text {
    font-size: 1.1rem;
    line-height: 1.8;
    color: var(--text-primary);
    margin: 0;
}

/* ============================================
   SMART UPSELLS
   ============================================ */

.upsell-section {
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
    padding: 25px;
    margin: 25px 0;
}

.upsell-section h3 {
    margin: 0 0 20px 0;
    color: var(--text-primary);
}

.upsell-cards {
    display: grid;
    gap: 15px;
}

.upsell-card {
    background: var(--bg-primary);
    border: 2px solid var(--accent-color);
    border-radius: var(--radius-md);
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    transition: var(--transition);
}

.upsell-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
}

.upsell-header {
    display: flex;
    align-items: center;
    gap: 12px;
}

.upsell-icon {
    font-size: 2rem;
}

.upsell-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
}

.upsell-message {
    font-size: 0.95rem;
    color: var(--text-secondary);
    line-height: 1.5;
    margin: 0;
}

.upsell-benefit {
    font-size: 0.9rem;
    color: var(--secondary-color);
    font-weight: 600;
    margin: 0;
}

.upsell-action {
    margin-top: 10px;
}

.btn-upsell {
    width: 100%;
    background: var(--accent-color);
    color: white;
    font-weight: 600;
}

.btn-upsell:hover {
    background: #d97706;
}

/* ============================================
   THREE-TIER PRICING
   ============================================ */

.three-tier-pricing {
    margin: 30px 0;
}

.three-tier-pricing h3 {
    text-align: center;
    font-size: 1.8rem;
    margin: 0 0 10px 0;
}

.tier-subtitle {
    text-align: center;
    color: var(--text-secondary);
    margin: 0 0 30px 0;
}

.pricing-tiers {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    margin: 20px 0;
}

@media (min-width: 768px) {
    .pricing-tiers {
        grid-template-columns: repeat(3, 1fr);
    }
}

.pricing-tier {
    background: var(--bg-primary);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: 25px;
    display: flex;
    flex-direction: column;
    transition: var(--transition);
    position: relative;
}

.pricing-tier:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-5px);
}

.tier-recommended {
    border-color: var(--primary-color);
    border-width: 3px;
    box-shadow: var(--shadow-md);
}

.tier-premium {
    border-color: var(--accent-color);
}

.tier-badge {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--primary-color);
    color: white;
    padding: 5px 15px;
    border-radius: var(--radius-full);
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.5px;
}

.tier-header {
    text-align: center;
    margin-bottom: 20px;
}

.tier-name {
    font-size: 1.5rem;
    margin: 0 0 8px 0;
    color: var(--text-primary);
}

.tier-description {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin: 0;
}

.tier-price {
    text-align: center;
    margin: 20px 0;
    padding: 20px 0;
    border-top: 1px solid var(--border-color);
    border-bottom: 1px solid var(--border-color);
}

.tier-price-amount {
    display: block;
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 8px;
}

.tier-price-range {
    display: block;
    font-size: 0.9rem;
    color: var(--text-tertiary);
}

.tier-features {
    list-style: none;
    padding: 0;
    margin: 20px 0;
    flex: 1;
}

.tier-features li {
    padding: 10px 0;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.95rem;
    color: var(--text-secondary);
}

.tier-features li:before {
    content: '‚úì';
    color: var(--secondary-color);
    font-weight: 700;
    font-size: 1.2rem;
}

.btn-tier {
    width: 100%;
    margin-top: auto;
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border: 2px solid var(--border-color);
}

.btn-tier:hover {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.btn-recommended {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.btn-recommended:hover {
    background: #2563eb;
}

.btn-premium:hover {
    background: var(--accent-color);
    border-color: var(--accent-color);
    color: white;
}

.pricing-tier.tier-selected {
    border-color: var(--secondary-color);
    border-width: 3px;
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
}

/* ============================================
   CREW AVAILABILITY CALENDAR
   ============================================ */

.crew-availability {
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
    padding: 25px;
    margin: 25px 0;
}

.crew-availability h3 {
    margin: 0 0 10px 0;
    color: var(--text-primary);
}

.availability-subtitle {
    color: var(--text-secondary);
    margin: 0 0 20px 0;
    font-size: 0.95rem;
}

.availability-calendar {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 12px;
    margin: 20px 0;
}

.availability-date {
    background: var(--bg-primary);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
}

.availability-date:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-sm);
    transform: translateY(-2px);
}

.availability-date.available {
    border-color: var(--secondary-color);
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(16, 185, 129, 0.1));
}

.availability-date.limited {
    border-color: var(--accent-color);
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), rgba(245, 158, 11, 0.1));
}

.availability-date.selected {
    border-color: var(--primary-color);
    background: var(--primary-color);
    color: white;
}

.date-label {
    display: block;
    font-size: 0.8rem;
    color: var(--text-tertiary);
    margin-bottom: 5px;
}

.availability-date.selected .date-label {
    color: rgba(255, 255, 255, 0.8);
}

.date-number {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
}

.availability-date.selected .date-number {
    color: white;
}

.availability-note {
    font-size: 0.85rem;
    color: var(--text-tertiary);
    text-align: center;
    margin: 15px 0 0 0;
}

/* ============================================
   FOOTER
   ============================================ */

.footer {
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.footer a {
    color: var(--primary-color);
    text-decoration: none;
}

.footer a:hover {
    text-decoration: underline;
}

.disclaimer {
    margin-top: 10px;
    font-size: 0.8rem;
    color: var(--text-tertiary);
}

/* ============================================
   LOADING OVERLAY
   ============================================ */

.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 5px solid rgba(255, 255, 255, 0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loading-overlay p {
    color: white;
    margin-top: 20px;
    font-size: 1.1rem;
}

/* ============================================
   RESPONSIVE - TABLET
   ============================================ */

@media (min-width: 640px) {
    body {
        padding: 30px 20px;
    }

    .container {
        padding: 40px;
    }

    .header h1 {
        font-size: 2.5rem;
    }

    .lead-form .form-row {
        grid-template-columns: 1fr 1fr;
    }

    .lead-form .form-row:last-of-type {
        grid-template-columns: 1fr;
    }
}

/* ============================================
   RESPONSIVE - DESKTOP
   ============================================ */

@media (min-width: 1024px) {
    .container {
        padding: 50px;
    }

    .category-items.active {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    }
}

/* ============================================
   PRINT STYLES
   ============================================ */

@media print {
    body {
        background: white;
        padding: 0;
    }

    .dark-mode-toggle,
    .mode-switcher,
    .action-buttons,
    .footer {
        display: none;
    }

    .container {
        box-shadow: none;
        max-width: 100%;
    }
}

/* ============================================
   NEW FEATURES - SOCIAL PROOF & ADD-ONS
   ============================================ */

/* Social Proof Banner */
.social-proof-banner {
    background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: 20px;
    margin-bottom: 30px;
}

.social-stats {
    display: flex;
    justify-content: center;
    gap: 30px;
    flex-wrap: wrap;
    margin-bottom: 15px;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 8px;
}

.stat-icon {
    font-size: 1.5rem;
}

.stat-text {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.stat-text strong {
    color: var(--primary-color);
    font-size: 1.1rem;
}

.trust-badges {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid var(--border-color);
}

.trust-badge {
    background: var(--bg-primary);
    padding: 6px 12px;
    border-radius: var(--radius-sm);
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--secondary-color);
    border: 1px solid var(--secondary-color);
}

.recent-booking {
    text-align: center;
    margin-top: 15px;
    padding: 10px;
    background: var(--bg-primary);
    border-radius: var(--radius-sm);
    font-size: 0.85rem;
    color: var(--text-secondary);
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Add-Ons Section */
.add-ons-section {
    margin-top: 30px;
    padding: 25px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
    border: 2px dashed var(--border-color);
}

.add-ons-section h3 {
    color: var(--primary-color);
    margin-bottom: 8px;
}

.add-ons-subtitle {
    color: var(--text-secondary);
    margin-bottom: 20px;
    font-size: 0.9rem;
}

.add-ons-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.add-on-card {
    background: var(--bg-primary);
    padding: 15px;
    border-radius: var(--radius-md);
    border: 2px solid var(--border-color);
    transition: var(--transition);
}

.add-on-card:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-md);
}

.add-on-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
}

.addon-checkbox {
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.add-on-header label {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    margin: 0;
}

.addon-icon {
    font-size: 1.5rem;
}

.addon-name {
    font-weight: 600;
    color: var(--text-primary);
}

.addon-price {
    font-weight: 700;
    color: var(--secondary-color);
}

.addon-description {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-bottom: 10px;
}

.addon-select,
.addon-input {
    width: 100%;
    padding: 8px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    background: var(--bg-secondary);
    color: var(--text-primary);
    margin-top: 10px;
}

.add-ons-total {
    text-align: right;
    padding: 15px;
    background: var(--bg-primary);
    border-radius: var(--radius-sm);
    font-size: 1.1rem;
    color: var(--primary-color);
}

/* Competitor Comparison */
.competitor-comparison {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    padding: 25px;
    border-radius: var(--radius-lg);
    margin: 30px 0;
    text-align: center;
}

.comparison-header h3 {
    margin-bottom: 20px;
    font-size: 1.5rem;
}

.comparison-grid {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 20px;
}

.comparison-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.comparison-label {
    font-size: 0.9rem;
    opacity: 0.9;
}

.comparison-value {
    font-size: 2rem;
    font-weight: 700;
}

.our-price {
    color: #fbbf24;
}

.competitor-price {
    text-decoration: line-through;
    opacity: 0.7;
}

.comparison-divider {
    font-size: 1.5rem;
    font-weight: 700;
    opacity: 0.7;
}

.savings-badge {
    background: rgba(255, 255, 255, 0.2);
    padding: 12px 24px;
    border-radius: var(--radius-md);
    font-size: 1.2rem;
    display: inline-block;
}

.savings-badge strong {
    color: #fbbf24;
    font-size: 1.5rem;
}

/* Dynamic Pricing Notice */
.dynamic-pricing-notice {
    margin: 20px 0;
}

.pricing-alert {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: white;
    padding: 15px 20px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    gap: 12px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
}

.alert-icon {
    font-size: 1.5rem;
}

.alert-text {
    font-weight: 600;
}

/* Tip Calculator */
.tip-calculator {
    background: var(--bg-tertiary);
    padding: 25px;
    border-radius: var(--radius-lg);
    margin: 25px 0;
    border-left: 4px solid var(--secondary-color);
}

.tip-calculator h3 {
    color: var(--primary-color);
    margin-bottom: 10px;
}

.tip-description {
    color: var(--text-secondary);
    margin-bottom: 20px;
    font-size: 0.9rem;
}

.tip-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 15px;
}

.tip-option {
    background: var(--bg-primary);
    padding: 15px;
    border-radius: var(--radius-md);
    border: 2px solid var(--border-color);
    text-align: center;
    transition: var(--transition);
}

.tip-option:hover {
    border-color: var(--secondary-color);
    transform: translateY(-2px);
}

.tip-option.recommended {
    border-color: var(--secondary-color);
    background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
}

.tip-label {
    display: block;
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin-bottom: 8px;
}

.tip-amount {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--secondary-color);
}

.tip-note {
    text-align: center;
    font-size: 0.85rem;
    color: var(--text-secondary);
    font-style: italic;
}

/* Referral Section */
.referral-section {
    margin: 25px 0;
}

.referral-card {
    background: linear-gradient(135deg, var(--primary-color), #2563eb);
    color: white;
    padding: 30px;
    border-radius: var(--radius-lg);
    text-align: center;
}

.referral-card h3 {
    margin-bottom: 10px;
    font-size: 1.5rem;
}

.referral-card p {
    margin-bottom: 20px;
    opacity: 0.9;
}

.referral-code-display {
    margin-bottom: 20px;
}

.referral-label {
    display: block;
    font-size: 0.9rem;
    margin-bottom: 10px;
    opacity: 0.9;
}

.code-box {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
}

.code {
    background: rgba(255, 255, 255, 0.2);
    padding: 12px 24px;
    border-radius: var(--radius-sm);
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: 2px;
    font-family: 'Courier New', monospace;
}

.btn-copy {
    background: rgba(255, 255, 255, 0.9);
    color: var(--primary-color);
    border: none;
    padding: 12px 20px;
    border-radius: var(--radius-sm);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
}

.btn-copy:hover {
    background: white;
    transform: scale(1.05);
}

.share-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
}

.btn-share {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
    padding: 10px 20px;
    border-radius: var(--radius-sm);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
}

.btn-share:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}

/* Checklist Section */
.checklist-section {
    margin: 25px 0;
}

.checklist-card {
    background: var(--bg-tertiary);
    padding: 25px;
    border-radius: var(--radius-lg);
    text-align: center;
    border: 2px solid var(--border-color);
}

.checklist-card h3 {
    color: var(--primary-color);
    margin-bottom: 10px;
}

.checklist-card p {
    color: var(--text-secondary);
    margin-bottom: 20px;
}

/* ============================================
   RESPONSIVE - MOBILE
   ============================================ */

@media (max-width: 640px) {
    .social-stats {
        flex-direction: column;
        gap: 15px;
    }

    .add-ons-grid {
        grid-template-columns: 1fr;
    }

    .comparison-grid {
        flex-direction: column;
        gap: 10px;
    }

    .tip-options {
        grid-template-columns: 1fr;
    }

    .code-box {
        flex-direction: column;
    }

    .share-buttons {
        flex-direction: column;
    }

    .btn-share {
        width: 100%;
    }
}

    </style>
</head>
<body>

    <!-- Dark Mode Toggle -->
    <button id="darkModeToggle" class="dark-mode-toggle" aria-label="Toggle dark mode">
        <span class="icon-sun">‚òÄÔ∏è</span>
        <span class="icon-moon">üåô</span>
    </button>

    <!-- Main Container -->
    <div class="container">

        <!-- Header -->
        <header class="header">
            <h1>Moving Cost Calculator</h1>
            <p class="subtitle">Get your free instant quote in 2 minutes</p>
        </header>

        <!-- Social Proof Banner -->
        <div class="social-proof-banner" id="socialProofBanner" style="display: none;">
            <div class="social-stats">
                <div class="stat-item">
                    <span class="stat-icon">‚≠ê</span>
                    <span class="stat-text"><strong id="avgRating">4.9</strong>/5 from <span id="totalReviews">1,200</span>+ reviews</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üë•</span>
                    <span class="stat-text"><strong id="totalCustomers">2,847</strong> happy customers this month</span>
                </div>
            </div>
            <div class="trust-badges" id="trustBadges">
                <!-- Dynamically populated -->
            </div>
            <div class="recent-booking" id="recentBooking">
                <!-- Dynamically populated -->
            </div>
        </div>

        <!-- Mode Switcher -->
        <div class="mode-switcher">
            <button class="mode-btn active" data-mode="inventory">
                üì¶ Full Inventory
            </button>
            <button class="mode-btn" data-mode="ai">
                ‚ö° Quick Estimate
            </button>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <p class="progress-text" id="progressText">Step 1 of 3: Select Items</p>

        <!-- Main Content Area -->
        <div class="content-wrapper">

            <!-- ============================================ -->
            <!-- INVENTORY MODE -->
            <!-- ============================================ -->
            <div id="inventoryMode" class="mode-content active">

                <!-- Inventory Summary Bar -->
                <div class="inventory-summary">
                    <div class="summary-item">
                        <span class="summary-label">Items:</span>
                        <span class="summary-value" id="totalItems">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Weight:</span>
                        <span class="summary-value" id="totalWeight">0 lbs</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Volume:</span>
                        <span class="summary-value" id="totalCubicFeet">0 cu ft</span>
                    </div>
                </div>

                <!-- Inventory Categories -->
                <div class="inventory-categories" id="inventoryCategories">
                    <!-- Dynamically loaded from inventory.json -->
                </div>

            </div>

            <!-- ============================================ -->
            <!-- AI QUICK ESTIMATE MODE -->
            <!-- ============================================ -->
            <div id="aiMode" class="mode-content">

                <div class="ai-input-section">
                    <h2>Describe Your Move</h2>
                    <p class="ai-hint">Tell us about your move and we'll estimate everything for you</p>

                    <textarea
                        id="aiInput"
                        class="ai-textarea"
                        placeholder="Example: I have a 2-bedroom apartment on the 3rd floor with no elevator. Moving about 20 miles away. I have a couch, queen bed, dining table, and about 30 boxes."
                        rows="5"
                    ></textarea>

                    <button class="btn btn-primary" id="aiEstimateBtn">
                        ‚ö° Generate Estimate
                    </button>

                    <!-- AI Parsed Results -->
                    <div id="aiParsedResults" class="ai-parsed-results" style="display: none;">
                        <h3>We detected:</h3>
                        <ul id="aiDetectedList"></ul>
                        <p class="ai-confidence">You can adjust details below before calculating</p>
                    </div>
                </div>

            </div>

            <!-- ============================================ -->
            <!-- MOVE DETAILS FORM (Common to both modes) -->
            <!-- ============================================ -->
            <div class="move-details-section" id="moveDetailsSection" style="display: none;">

                <h2>Move Details</h2>

                <div class="form-grid">

                    <!-- Distance -->
                    <div class="form-group">
                        <label for="distance">Distance (miles)</label>
                        <input type="number" id="distance" min="1" value="10" required>
                        <small>Enter the distance between pickup and delivery</small>
                    </div>

                    <!-- Number of Movers -->
                    <div class="form-group">
                        <label for="numMovers">Number of Movers</label>
                        <select id="numMovers">
                            <option value="auto">Auto-Calculate (Recommended)</option>
                            <option value="1">1 Mover</option>
                            <option value="2">2 Movers</option>
                            <option value="3">3 Movers</option>
                            <option value="4">4 Movers</option>
                            <option value="5">5+ Movers</option>
                        </select>
                    </div>

                    <!-- Truck Size -->
                    <div class="form-group">
                        <label for="truckSize">Truck Size</label>
                        <select id="truckSize">
                            <option value="auto">Auto-Calculate (Recommended)</option>
                            <option value="10ft">10ft Truck (Studio/Small 1BR)</option>
                            <option value="16ft">16ft Truck (1-2 BR Apartment)</option>
                            <option value="20ft">20ft Truck (2-3 BR House)</option>
                            <option value="26ft">26ft Truck (3+ BR House)</option>
                        </select>
                    </div>

                    <!-- Hourly Rate (Editable) -->
                    <div class="form-group">
                        <label for="hourlyRate">Hourly Rate per Mover ($)</label>
                        <input type="number" id="hourlyRate" min="25" max="150" value="45" step="5">
                        <small>Adjust if needed</small>
                    </div>

                    <!-- Stairs/Floors -->
                    <div class="form-group">
                        <label for="stairs">Stairs/Floors</label>
                        <select id="stairs">
                            <option value="0">No Stairs (Ground floor/Elevator)</option>
                            <option value="1">1 Flight of Stairs</option>
                            <option value="2">2 Flights of Stairs</option>
                            <option value="3">3+ Flights of Stairs</option>
                        </select>
                    </div>

                    <!-- Packing Service -->
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="packingService">
                            Add Packing Service (+30%)
                        </label>
                    </div>

                    <!-- Long Carry -->
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="longCarry">
                            Long Carry (50+ ft from truck)
                        </label>
                    </div>

                </div>

                <!-- Add-On Services Section -->
                <div class="add-ons-section" id="addOnsSection" style="display: none;">
                    <h3>üéÅ Add Extra Services (Optional)</h3>
                    <p class="add-ons-subtitle">Enhance your move with these popular add-ons</p>

                    <div class="add-ons-grid">
                        <!-- Packing Materials -->
                        <div class="add-on-card" data-addon="packing_materials">
                            <div class="add-on-header">
                                <input type="checkbox" id="addon_packing" class="addon-checkbox">
                                <label for="addon_packing">
                                    <span class="addon-icon">üì¶</span>
                                    <span class="addon-name">Packing Materials Kit</span>
                                </label>
                                <span class="addon-price" id="packingPrice">$0</span>
                            </div>
                            <p class="addon-description">Complete supplies delivered to you</p>
                        </div>

                        <!-- Insurance -->
                        <div class="add-on-card" data-addon="insurance">
                            <div class="add-on-header">
                                <input type="checkbox" id="addon_insurance" class="addon-checkbox">
                                <label for="addon_insurance">
                                    <span class="addon-icon">üõ°Ô∏è</span>
                                    <span class="addon-name">Moving Insurance</span>
                                </label>
                                <span class="addon-price" id="insurancePrice">$0</span>
                            </div>
                            <p class="addon-description">Protect your belongings</p>
                            <select id="insuranceLevel" class="addon-select" style="display: none;">
                                <option value="basic">Basic ($0.60/lb)</option>
                                <option value="premium">Full Replacement</option>
                            </select>
                        </div>

                        <!-- Assembly -->
                        <div class="add-on-card" data-addon="assembly">
                            <div class="add-on-header">
                                <input type="checkbox" id="addon_assembly" class="addon-checkbox">
                                <label for="addon_assembly">
                                    <span class="addon-icon">üîß</span>
                                    <span class="addon-name">Furniture Assembly</span>
                                </label>
                                <span class="addon-price">$25/item</span>
                            </div>
                            <p class="addon-description">We'll assemble/disassemble furniture</p>
                            <input type="number" id="assemblyItems" class="addon-input" min="0" placeholder="# of items" style="display: none;">
                        </div>

                        <!-- Storage -->
                        <div class="add-on-card" data-addon="storage">
                            <div class="add-on-header">
                                <input type="checkbox" id="addon_storage" class="addon-checkbox">
                                <label for="addon_storage">
                                    <span class="addon-icon">üè¢</span>
                                    <span class="addon-name">Storage (1st Month FREE)</span>
                                </label>
                                <span class="addon-price">$0</span>
                            </div>
                            <p class="addon-description">Climate-controlled storage</p>
                        </div>

                        <!-- Junk Removal -->
                        <div class="add-on-card" data-addon="junk">
                            <div class="add-on-header">
                                <input type="checkbox" id="addon_junk" class="addon-checkbox">
                                <label for="addon_junk">
                                    <span class="addon-icon">üóëÔ∏è</span>
                                    <span class="addon-name">Junk Removal</span>
                                </label>
                                <span class="addon-price">$35/item</span>
                            </div>
                            <p class="addon-description">We'll haul away unwanted items</p>
                            <input type="number" id="junkItems" class="addon-input" min="0" placeholder="# of items" style="display: none;">
                        </div>

                        <!-- Cleaning -->
                        <div class="add-on-card" data-addon="cleaning">
                            <div class="add-on-header">
                                <input type="checkbox" id="addon_cleaning" class="addon-checkbox">
                                <label for="addon_cleaning">
                                    <span class="addon-icon">üßπ</span>
                                    <span class="addon-name">Move-Out Cleaning</span>
                                </label>
                                <span class="addon-price" id="cleaningPrice">$0</span>
                            </div>
                            <p class="addon-description">Professional deep cleaning</p>
                        </div>
                    </div>

                    <div class="add-ons-total" id="addOnsTotal" style="display: none;">
                        <strong>Add-Ons Total:</strong> <span id="addOnsTotalAmount">$0</span>
                    </div>
                </div>

                <button class="btn btn-primary btn-large" id="calculateBtn">
                    üßÆ Calculate My Cost
                </button>

            </div>

            <!-- ============================================ -->
            <!-- PARTIAL RESULTS (Before Lead Capture) -->
            <!-- ============================================ -->
            <div class="results-section partial-results" id="partialResults" style="display: none;">

                <div class="results-hero">
                    <h2>Your Estimated Moving Cost</h2>
                    <div class="cost-range">
                        <div class="cost-amount">
                            <span class="cost-label">Low Estimate</span>
                            <span class="cost-value" id="costLow">$0</span>
                        </div>
                        <div class="cost-divider">‚Äî</div>
                        <div class="cost-amount">
                            <span class="cost-label">High Estimate</span>
                            <span class="cost-value" id="costHigh">$0</span>
                        </div>
                    </div>
                </div>

                <div class="quick-facts">
                    <div class="fact-item">
                        <span class="fact-icon">üöö</span>
                        <span class="fact-label">Truck Size</span>
                        <span class="fact-value" id="truckSize">‚Äî</span>
                    </div>
                    <div class="fact-item">
                        <span class="fact-icon">üë∑</span>
                        <span class="fact-label">Crew Size</span>
                        <span class="fact-value" id="crewSize">‚Äî</span>
                    </div>
                    <div class="fact-item">
                        <span class="fact-icon">‚è±Ô∏è</span>
                        <span class="fact-label">Est. Time</span>
                        <span class="fact-value" id="estTime">‚Äî</span>
                    </div>
                </div>

                <!-- Competitor Comparison -->
                <div class="competitor-comparison" id="competitorComparison" style="display: none;">
                    <div class="comparison-header">
                        <h3>üí∞ You're Getting a Great Deal!</h3>
                    </div>
                    <div class="comparison-grid">
                        <div class="comparison-item">
                            <span class="comparison-label">Our Quote:</span>
                            <span class="comparison-value our-price" id="ourQuote">$1,450</span>
                        </div>
                        <div class="comparison-divider">vs</div>
                        <div class="comparison-item">
                            <span class="comparison-label">Industry Average:</span>
                            <span class="comparison-value competitor-price" id="competitorQuote">$1,850</span>
                        </div>
                    </div>
                    <div class="savings-badge">
                        üéâ YOU SAVE: <strong id="savingsAmount">$400</strong>
                    </div>
                </div>

                <!-- Move Risk Score -->
                <div class="risk-score-badge" id="riskScoreBadge" style="display: none;">
                    <div class="risk-score-content">
                        <span class="risk-icon" id="riskIcon">‚úÖ</span>
                        <div class="risk-info">
                            <span class="risk-label" id="riskLabel">Low Risk Move</span>
                            <span class="risk-message" id="riskMessage">Your move looks straightforward!</span>
                        </div>
                    </div>
                </div>

                <!-- AI Generated Summary -->
                <div class="ai-summary-section" id="aiSummarySection" style="display: none;">
                    <h3>üìã Move Summary</h3>
                    <p class="ai-summary-text" id="aiSummaryText"></p>
                </div>

                <!-- Smart Upsell Recommendations -->
                <div class="upsell-section" id="upsellSection" style="display: none;">
                    <h3>üí° Recommended for Your Move</h3>
                    <div class="upsell-cards" id="upsellCards">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Dynamic Pricing Notice -->
                <div class="dynamic-pricing-notice" id="dynamicPricingNotice" style="display: none;">
                    <div class="pricing-alert">
                        <span class="alert-icon">‚ö°</span>
                        <span class="alert-text" id="pricingAlertText"></span>
                    </div>
                </div>

                <!-- Crew Availability Calendar -->
                <div class="crew-availability" id="crewAvailability" style="display: none;">
                    <h3>üìÖ Available Move Dates</h3>
                    <p class="availability-subtitle">Select your preferred move date</p>
                    <div class="availability-calendar" id="availabilityCalendar">
                        <!-- Dynamically populated -->
                    </div>
                    <p class="availability-note">‚ú® Dates in green are available | ‚ö†Ô∏è Yellow = limited availability</p>
                </div>

                <!-- Lead Capture Form -->
                <div class="lead-capture">
                    <h3>Get Full Breakdown + PDF Quote</h3>
                    <p>Enter your details to see itemized costs and download your quote</p>

                    <form id="leadCaptureForm" class="lead-form">
                        <div class="form-row">
                            <input type="text" id="leadName" placeholder="Your Name" required>
                            <input type="email" id="leadEmail" placeholder="Email Address" required>
                        </div>
                        <div class="form-row">
                            <input type="tel" id="leadPhone" placeholder="Phone (optional)">
                        </div>
                        <button type="submit" class="btn btn-primary btn-large" id="getQuoteBtn">
                            üìß Get Full Quote
                        </button>
                    </form>
                </div>

            </div>

            <!-- ============================================ -->
            <!-- FULL RESULTS (After Lead Capture) -->
            <!-- ============================================ -->
            <div class="results-section full-results" id="fullResults" style="display: none;">

                <div class="results-header">
                    <h2>Your Complete Moving Quote</h2>
                    <p class="customer-name">Prepared for: <span id="customerName"></span></p>
                </div>

                <!-- AI Generated Summary (Full Version) -->
                <div class="ai-summary-full" id="aiSummaryFull" style="display: none;">
                    <div class="summary-card">
                        <h3>üìã Your Move at a Glance</h3>
                        <p class="summary-text" id="aiSummaryFullText"></p>
                    </div>
                </div>

                <!-- Three-Tier Pricing Options -->
                <div class="three-tier-pricing" id="threeTierPricing" style="display: none;">
                    <h3>Choose Your Service Level</h3>
                    <p class="tier-subtitle">Select the level of service that best fits your needs</p>
                    <div class="pricing-tiers">
                        <div class="pricing-tier" data-tier="saver" id="tierSaver">
                            <div class="tier-header">
                                <h4 class="tier-name">Saver</h4>
                                <p class="tier-description">Basic service - great value</p>
                            </div>
                            <div class="tier-price">
                                <span class="tier-price-amount" id="priceSaver">$1,200</span>
                                <span class="tier-price-range" id="priceSaverRange">$1,080 - $1,380</span>
                            </div>
                            <ul class="tier-features" id="featuresSaver">
                                <!-- Dynamically populated -->
                            </ul>
                            <button class="btn btn-tier" data-tier="saver">Select Saver</button>
                        </div>

                        <div class="pricing-tier tier-recommended" data-tier="standard" id="tierStandard">
                            <div class="tier-badge">MOST POPULAR</div>
                            <div class="tier-header">
                                <h4 class="tier-name">Standard</h4>
                                <p class="tier-description">Most popular choice</p>
                            </div>
                            <div class="tier-price">
                                <span class="tier-price-amount" id="priceStandard">$1,450</span>
                                <span class="tier-price-range" id="priceStandardRange">$1,300 - $1,670</span>
                            </div>
                            <ul class="tier-features" id="featuresStandard">
                                <!-- Dynamically populated -->
                            </ul>
                            <button class="btn btn-tier btn-recommended" data-tier="standard">Select Standard</button>
                        </div>

                        <div class="pricing-tier tier-premium" data-tier="white_glove" id="tierWhiteGlove">
                            <div class="tier-header">
                                <h4 class="tier-name">White Glove</h4>
                                <p class="tier-description">Premium service</p>
                            </div>
                            <div class="tier-price">
                                <span class="tier-price-amount" id="priceWhiteGlove">$1,950</span>
                                <span class="tier-price-range" id="priceWhiteGloveRange">$1,750 - $2,240</span>
                            </div>
                            <ul class="tier-features" id="featuresWhiteGlove">
                                <!-- Dynamically populated -->
                            </ul>
                            <button class="btn btn-tier btn-premium" data-tier="white_glove">Select White Glove</button>
                        </div>
                    </div>
                </div>

                <!-- Cost Summary -->
                <div class="cost-summary">
                    <h3>Selected Service: <span id="selectedTierName">Standard</span></h3>
                    <div class="cost-range-large">
                        <span id="finalCostLow">$0</span> ‚Äî <span id="finalCostHigh">$0</span>
                    </div>
                </div>

                <!-- Line Item Breakdown -->
                <div class="breakdown-section">
                    <h3>Cost Breakdown</h3>
                    <table class="breakdown-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Details</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody id="breakdownTableBody">
                            <!-- Dynamically populated -->
                        </tbody>
                    </table>
                </div>

                <!-- Move Details Summary -->
                <div class="move-summary">
                    <h3>Move Details</h3>
                    <div id="moveSummaryContent"></div>
                </div>

                <!-- Tip Calculator -->
                <div class="tip-calculator" id="tipCalculator" style="display: none;">
                    <h3>üíµ Suggested Tip for Your Movers</h3>
                    <p class="tip-description">Industry standard is 15-20% of labor cost or $20-40 per mover</p>
                    <div class="tip-options">
                        <div class="tip-option">
                            <span class="tip-label">15% (Good)</span>
                            <span class="tip-amount" id="tip15">$0</span>
                        </div>
                        <div class="tip-option recommended">
                            <span class="tip-label">18% (Recommended)</span>
                            <span class="tip-amount" id="tip18">$0</span>
                        </div>
                        <div class="tip-option">
                            <span class="tip-label">20% (Excellent)</span>
                            <span class="tip-amount" id="tip20">$0</span>
                        </div>
                    </div>
                    <p class="tip-note">üí° Tip: Have cash ready on moving day</p>
                </div>

                <!-- Referral Program -->
                <div class="referral-section" id="referralSection" style="display: none;">
                    <div class="referral-card">
                        <h3>üéÅ Refer a Friend, Get $100 Off!</h3>
                        <p>Share your unique code and you both save $100</p>
                        <div class="referral-code-display">
                            <span class="referral-label">Your Referral Code:</span>
                            <div class="code-box">
                                <span class="code" id="referralCode">REF123ABC</span>
                                <button class="btn-copy" id="copyReferralBtn">üìã Copy</button>
                            </div>
                        </div>
                        <div class="share-buttons">
                            <button class="btn-share" id="shareEmailBtn">üìß Email</button>
                            <button class="btn-share" id="shareTextBtn">üí¨ Text</button>
                            <button class="btn-share" id="shareSocialBtn">üîó Share</button>
                        </div>
                    </div>
                </div>

                <!-- Moving Checklist -->
                <div class="checklist-section" id="checklistSection" style="display: none;">
                    <div class="checklist-card">
                        <h3>üìã Your Moving Checklist</h3>
                        <p>Stay organized with our comprehensive moving timeline</p>
                        <button class="btn btn-outline" id="downloadChecklistBtn">
                            üì• Download Moving Checklist PDF
                        </button>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary btn-book-now" id="bookNowBtn" style="display: none;">
                        üìÖ <span id="bookNowText">Book Your Move Today</span>
                    </button>
                    <button class="btn btn-success btn-call-office" id="callOfficeBtn" style="display: none;">
                        üìû Call Office: <span id="officePhone">(555) 123-4567</span>
                    </button>
                    <button class="btn btn-primary" id="downloadPdfBtn">
                        üìÑ Download PDF Quote
                    </button>
                    <button class="btn btn-secondary" id="emailQuoteBtn">
                        üìß Email This Quote
                    </button>
                    <button class="btn btn-secondary" id="textQuoteBtn" style="display: none;">
                        üí¨ Text Me This Quote
                    </button>
                    <button class="btn btn-outline" id="startOverBtn">
                        üîÑ Start New Quote
                    </button>
                </div>

            </div>

        </div>

        <!-- Footer -->
        <footer class="footer">
            <p id="brandingText">Powered by <a href="https://routinemoves.ai" target="_blank">RoutineMoves</a></p>
            <p class="disclaimer">Estimates are approximate and subject to change based on actual move conditions.</p>
        </footer>

    </div>

    <!-- Loading Spinner -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="spinner"></div>
        <p>Calculating your estimate...</p>
    </div>

    <!-- Embedded Data (embedded to avoid CDN/CORS issues) -->
    <script>
        // Embed inventory data
        window.EMBEDDED_INVENTORY = {"categories":{"living_room":{"name":"Living Room","items":{"sofa_3seat":{"name":"Sofa (3-seat)","weight":350,"icon":"üõãÔ∏è"},"sofa_2seat":{"name":"Loveseat (2-seat)","weight":224,"icon":"üõãÔ∏è"},"armchair":{"name":"Armchair","weight":100,"icon":"ü™ë"},"recliner":{"name":"Recliner","weight":150,"icon":"ü™ë"},"coffee_table":{"name":"Coffee Table","weight":75,"icon":"‚òï"},"end_table":{"name":"End Table","weight":35,"icon":"ü™î"},"tv_stand":{"name":"TV Stand","weight":85,"icon":"üì∫"},"entertainment_center":{"name":"Entertainment Center","weight":250,"icon":"üì∫"},"bookshelf_small":{"name":"Bookshelf (Small)","weight":70,"icon":"üìö"},"bookshelf_large":{"name":"Bookshelf (Large)","weight":150,"icon":"üìö"},"lamp_floor":{"name":"Floor Lamp","weight":25,"icon":"üí°"},"lamp_table":{"name":"Table Lamp","weight":10,"icon":"üí°"}}},"bedroom":{"name":"Bedroom","items":{"king_bed":{"name":"King Bed (frame + mattress)","weight":350,"icon":"üõèÔ∏è"},"queen_bed":{"name":"Queen Bed (frame + mattress)","weight":300,"icon":"üõèÔ∏è"},"full_bed":{"name":"Full Bed (frame + mattress)","weight":250,"icon":"üõèÔ∏è"},"twin_bed":{"name":"Twin Bed (frame + mattress)","weight":175,"icon":"üõèÔ∏è"},"bunk_bed":{"name":"Bunk Bed","weight":300,"icon":"üõèÔ∏è"},"nightstand":{"name":"Nightstand","weight":50,"icon":"üïØÔ∏è"},"dresser_small":{"name":"Dresser (3-4 drawers)","weight":150,"icon":"üóÑÔ∏è"},"dresser_large":{"name":"Dresser (6+ drawers)","weight":250,"icon":"üóÑÔ∏è"},"chest_of_drawers":{"name":"Chest of Drawers","weight":175,"icon":"üóÑÔ∏è"},"wardrobe":{"name":"Wardrobe/Armoire","weight":300,"icon":"üëó"},"mirror_large":{"name":"Large Mirror","weight":50,"icon":"ü™û"},"vanity":{"name":"Vanity Table","weight":125,"icon":"üíÑ"}}},"dining":{"name":"Dining Room","items":{"dining_table_small":{"name":"Dining Table (4-seater)","weight":150,"icon":"üçΩÔ∏è"},"dining_table_large":{"name":"Dining Table (6+ seater)","weight":250,"icon":"üçΩÔ∏è"},"dining_chair":{"name":"Dining Chair","weight":35,"icon":"ü™ë"},"bench":{"name":"Dining Bench","weight":75,"icon":"ü™ë"},"china_cabinet":{"name":"China Cabinet","weight":300,"icon":"üóÑÔ∏è"},"buffet":{"name":"Buffet/Sideboard","weight":200,"icon":"üóÑÔ∏è"},"bar_cart":{"name":"Bar Cart","weight":50,"icon":"üç∑"}}},"office":{"name":"Office/Study","items":{"desk_small":{"name":"Desk (Small)","weight":100,"icon":"üñ•Ô∏è"},"desk_large":{"name":"Desk (Large/Executive)","weight":200,"icon":"üñ•Ô∏è"},"office_chair":{"name":"Office Chair","weight":50,"icon":"ü™ë"},"filing_cabinet_2drawer":{"name":"Filing Cabinet (2-drawer)","weight":75,"icon":"üóÑÔ∏è"},"filing_cabinet_4drawer":{"name":"Filing Cabinet (4-drawer)","weight":150,"icon":"üóÑÔ∏è"},"bookshelf_office":{"name":"Office Bookshelf","weight":125,"icon":"üìö"},"computer_desk":{"name":"Computer Desk","weight":125,"icon":"üíª"}}},"appliances":{"name":"Appliances","items":{"refrigerator":{"name":"Refrigerator","weight":300,"icon":"üßä"},"freezer":{"name":"Freezer (Upright)","weight":250,"icon":"‚ùÑÔ∏è"},"washer":{"name":"Washing Machine","weight":200,"icon":"üß∫"},"dryer":{"name":"Dryer","weight":150,"icon":"üß∫"},"dishwasher":{"name":"Dishwasher","weight":175,"icon":"üçΩÔ∏è"},"stove":{"name":"Stove/Range","weight":250,"icon":"üî•"},"microwave":{"name":"Microwave","weight":50,"icon":"‚è≤Ô∏è"},"tv_small":{"name":"TV (32-42 inch)","weight":35,"icon":"üì∫"},"tv_medium":{"name":"TV (43-55 inch)","weight":50,"icon":"üì∫"},"tv_large":{"name":"TV (55+ inch)","weight":75,"icon":"üì∫"}}},"outdoor":{"name":"Outdoor/Patio","items":{"patio_table":{"name":"Patio Table","weight":100,"icon":"üçΩÔ∏è"},"patio_chair":{"name":"Patio Chair","weight":30,"icon":"ü™ë"},"grill":{"name":"BBQ Grill","weight":150,"icon":"üî•"},"patio_umbrella":{"name":"Patio Umbrella","weight":40,"icon":"‚òÇÔ∏è"},"lawn_mower":{"name":"Lawn Mower","weight":90,"icon":"üå±"},"bike":{"name":"Bicycle","weight":30,"icon":"üö≤"},"exercise_equipment":{"name":"Exercise Equipment","weight":150,"icon":"üèãÔ∏è"}}},"boxes":{"name":"Boxes & Bins","items":{"small_box":{"name":"Small Box (1.5 cu ft)","weight":30,"icon":"üì¶"},"medium_box":{"name":"Medium Box (3 cu ft)","weight":45,"icon":"üì¶"},"large_box":{"name":"Large Box (4.5 cu ft)","weight":60,"icon":"üì¶"},"wardrobe_box":{"name":"Wardrobe Box","weight":25,"icon":"üëî"},"plastic_bin":{"name":"Plastic Storage Bin","weight":35,"icon":"üóÉÔ∏è"}}},"miscellaneous":{"name":"Miscellaneous","items":{"rug_small":{"name":"Rug (Small)","weight":20,"icon":"üé®"},"rug_large":{"name":"Rug (Large)","weight":50,"icon":"üñºÔ∏è"},"piano_upright":{"name":"Upright Piano","weight":600,"icon":"üéπ"},"piano_grand":{"name":"Grand Piano","weight":1200,"icon":"üéπ"},"safe_small":{"name":"Safe (Small)","weight":200,"icon":"üîí"},"safe_large":{"name":"Safe (Large)","weight":500,"icon":"üîí"},"pool_table":{"name":"Pool Table","weight":1000,"icon":"üé±"},"mattress_only":{"name":"Mattress Only (Queen)","weight":150,"icon":"üõèÔ∏è"}}}},"ai_estimation_defaults":{"studio":{"weight":2000,"cubic_feet":285,"typical_items":25},"one_bedroom":{"weight":3500,"cubic_feet":500,"typical_items":40},"two_bedroom":{"weight":5500,"cubic_feet":785,"typical_items":65},"three_bedroom":{"weight":8000,"cubic_feet":1142,"typical_items":95},"four_bedroom":{"weight":10500,"cubic_feet":1500,"typical_items":125},"five_bedroom_plus":{"weight":13000,"cubic_feet":1857,"typical_items":155}},"multipliers":{"stairs_per_floor":1.15,"elevator_available":0.95,"long_walk":1.1,"packing_required":1.3,"fragile_items":1.2}};

        // Embed config data
        window.EMBEDDED_CONFIG = {"company":{"name":"Your Moving Company","phone":"(555) 123-4567","email":"info@yourmovingcompany.com","website":"https://yourmovingcompany.com","logo_url":"","brand_color":"#3b82f6"},"pricing":{"labor":{"hourly_rate_per_mover":45,"allow_customer_to_edit_rate":false,"minimum_hours":2,"overtime_rate_multiplier":1.5,"overtime_starts_after_hours":8},"crew":{"default_movers":2,"auto_calculate_crew":true,"crew_sizing":{"0_500_lbs":1,"501_2000_lbs":2,"2001_5000_lbs":3,"5001_8000_lbs":4,"8001_plus_lbs":5}},"trucks":{"10ft":{"max_cubic_feet":400,"max_weight":2800,"daily_rate":89,"hourly_rate":0,"name":"10ft Truck (Studio/Small 1BR)"},"16ft":{"max_cubic_feet":800,"max_weight":5600,"daily_rate":129,"hourly_rate":0,"name":"16ft Truck (1-2 BR Apartment)"},"20ft":{"max_cubic_feet":1000,"max_weight":7000,"daily_rate":169,"hourly_rate":0,"name":"20ft Truck (2-3 BR House)"},"26ft":{"max_cubic_feet":1500,"max_weight":10000,"daily_rate":199,"hourly_rate":0,"name":"26ft Truck (3+ BR House)"}},"fees":{"fuel_surcharge_per_mile":2.00,"truck_equipment_fee":150,"start_cost_per_mile":5.00,"start_cost_applies_to_first_miles":10,"regular_cost_per_mile_after_start":2.50,"optional_fees":{"stairs_per_flight":50,"long_carry_per_50ft":35,"elevator_wait_per_30min":40,"packing_service_per_hour":60,"assembly_disassembly_per_item":25,"appliance_disconnect_reconnect":75,"piano_moving_upright":200,"piano_moving_grand":400,"storage_first_month":150}},"distance_pricing":{"local_max_miles":50,"local_pricing_mode":"hourly","long_distance_min_miles":51,"long_distance_base_rate":500,"long_distance_per_mile":3.50,"long_distance_includes_loading_unloading":true},"calculation_settings":{"pounds_to_cubic_feet_divisor":7,"loading_rate_lbs_per_mover_per_hour":1000,"unloading_rate_lbs_per_mover_per_hour":1200,"average_truck_speed_mph":45,"cost_range_low_multiplier":0.90,"cost_range_high_multiplier":1.15,"packing_time_multiplier":1.3,"stairs_time_multiplier":1.15,"fragile_items_time_multiplier":1.2},"dynamic_pricing":{"enabled":true,"peak_season":{"enabled":true,"months":[5,6,7,8,9],"multiplier":1.20,"description":"Peak moving season (May-Sep)"},"weekend_pricing":{"enabled":true,"days":[0,6],"multiplier":1.15,"description":"Weekend moves (Sat/Sun)"},"month_end":{"enabled":true,"days":[1,28,29,30,31],"multiplier":1.25,"description":"First/last of month rush"},"holidays":{"enabled":true,"multiplier":1.30,"dates":["2024-07-04","2024-09-02","2024-11-28"],"description":"Holiday pricing"},"rush_move":{"enabled":true,"within_days":3,"multiplier":1.50,"description":"Rush move (within 3 days)"}},"add_on_services":{"packing_materials":{"enabled":true,"name":"Packing Materials Kit","description":"Complete packing supplies delivered","auto_calculate":true,"items":{"small_box":{"name":"Small Box","price":2.50,"per_bedroom":5},"medium_box":{"name":"Medium Box","price":3.00,"per_bedroom":10},"large_box":{"name":"Large Box","price":3.50,"per_bedroom":8},"wardrobe_box":{"name":"Wardrobe Box","price":8.00,"per_bedroom":2},"bubble_wrap":{"name":"Bubble Wrap Roll","price":12.00,"per_move":2},"packing_tape":{"name":"Packing Tape","price":4.00,"per_move":3},"markers":{"name":"Markers","price":3.00,"per_move":1}}},"insurance":{"enabled":true,"name":"Moving Insurance","description":"Protect your belongings","options":[{"level":"basic","name":"Basic Coverage ($0.60/lb)","rate_per_pound":0.60,"max_coverage":5000,"price_calculation":"weight"},{"level":"premium","name":"Full Replacement Value","base_price":150,"per_1000_value":5,"description":"Full replacement cost coverage"}]},"assembly":{"enabled":true,"name":"Furniture Assembly/Disassembly","price_per_item":25,"description":"Professional assembly service","common_items":["Bed Frame","Desk","Bookshelf","Dining Table","TV Stand"]},"storage":{"enabled":true,"name":"Climate-Controlled Storage","first_month_price":0,"regular_monthly_price":150,"promotion":"First month FREE","description":"Secure, climate-controlled storage"},"junk_removal":{"enabled":true,"name":"Junk Removal Service","price_per_item":35,"truck_load_price":250,"description":"We'll haul away unwanted items"},"cleaning":{"enabled":true,"name":"Move-Out Cleaning","studio_1br":150,"2br":225,"3br":300,"4br_plus":400,"description":"Professional deep cleaning"}}},"lead_capture":{"require_email":true,"require_phone":false,"show_partial_estimate_first":true,"partial_estimate_shows":{"cost_range":true,"truck_size":true,"crew_size":true,"labor_hours":false,"breakdown":false},"full_estimate_requires_email":true},"integrations":{"webhook":{"enabled":false,"url":"https://hooks.zapier.com/hooks/catch/YOUR_WEBHOOK_ID/","method":"POST","include_inventory_list":true,"send_on_partial_view":false,"send_on_full_view":true},"zapier":{"enabled":false,"webhook_url":"","instructions":"Create a Zap with 'Webhooks by Zapier' trigger, then paste the webhook URL above"},"trello":{"enabled":false,"api_key":"","token":"","board_id":"","list_id":"","instructions":"Get API credentials from https://trello.com/app-key"},"hubspot":{"enabled":false,"api_key":"","instructions":"Add your HubSpot API key to create deals automatically"},"email":{"enabled":false,"service":"mailto","smtp_instructions":"For production, use a service like SendGrid, Mailgun, or AWS SES"},"sms":{"enabled":false,"twilio_account_sid":"","twilio_auth_token":"","twilio_phone_number":"","instructions":"Add Twilio credentials to enable 'Text me this quote' feature"}},"social_proof":{"enabled":true,"total_customers_this_month":2847,"total_reviews":1200,"average_rating":4.9,"recent_bookings":[{"name":"Sarah","location":"Chicago","minutes_ago":12},{"name":"Mike","location":"Austin","minutes_ago":45},{"name":"Jennifer","location":"Seattle","minutes_ago":67}],"trust_badges":["Licensed & Insured","5-Star Rated","Family Owned"]},"competitor_comparison":{"enabled":true,"industry_average_multiplier":1.27,"show_savings_badge":true,"competitor_names":["Industry Average","Typical Moving Company"]},"tip_calculator":{"enabled":true,"suggested_percentage_low":15,"suggested_percentage_high":20,"show_in_final_results":true,"description":"Industry standard is 15-20% of labor cost or $20-40 per mover"},"referral_program":{"enabled":true,"discount_amount":100,"description":"Refer a friend, you both get $100 off","code_prefix":"REF","show_after_quote":true},"moving_checklist":{"enabled":true,"generate_pdf":true,"items":[{"weeks_before":4,"task":"Reserve elevator and get parking permits"},{"weeks_before":3,"task":"Start decluttering and donate unwanted items"},{"weeks_before":2,"task":"Begin packing non-essential items"},{"weeks_before":1,"task":"Confirm move date and details with company"},{"days_before":3,"task":"Pack essential bag for moving day"},{"days_before":1,"task":"Defrost refrigerator and prepare appliances"},{"moving_day":true,"task":"Have cash/tip ready for movers"}]},"ui_settings":{"theme":{"primary_color":"#3b82f6","secondary_color":"#10b981","accent_color":"#f59e0b","dark_mode_available":true,"default_dark_mode":false},"branding":{"show_powered_by":true,"powered_by_text":"Powered by RoutineMoves","powered_by_url":"https://routinemoves.ai","custom_footer_text":""},"features":{"enable_inventory_mode":true,"enable_ai_quick_estimate":true,"enable_pdf_export":true,"enable_email_quote":true,"enable_sms_quote":false,"enable_admin_mode":true,"show_cost_breakdown":true,"show_tips_and_recommendations":true,"enable_dynamic_pricing":true,"enable_add_on_services":true,"enable_social_proof":true,"enable_competitor_comparison":true,"enable_tip_calculator":true,"enable_referral_program":true,"enable_moving_checklist":true}},"admin_mode":{"enabled":true,"password":"admin123","instructions":"Add ?admin=true to URL and enter password to test without lead capture"},"booking":{"enabled":true,"phone":"(555) 123-4567","book_now_url":"https://yourmovingcompany.com/book","calendar_url":"","show_call_button":true,"show_book_button":true,"cta_text_urgent":"Book Now - Limited Availability!","cta_text_normal":"Book Your Move Today"},"three_tier_pricing":{"enabled":true,"tiers":{"saver":{"name":"Saver","multiplier":0.85,"description":"Basic service - great value","features":["Professional movers","Basic equipment included","Standard insurance coverage"]},"standard":{"name":"Standard","multiplier":1.0,"description":"Most popular choice","recommended":true,"features":["Professional movers","Full equipment & padding","Enhanced insurance coverage","Furniture protection"]},"white_glove":{"name":"White Glove","multiplier":1.35,"description":"Premium service","features":["Expert white-glove movers","Premium equipment & materials","Full replacement insurance","Complete furniture protection","Unpacking & setup service","Same-day assembly"]}}},"move_risk_score":{"enabled":true,"factors":{"weight_threshold_high":8000,"stairs_high_risk":3,"long_distance_threshold":100,"fragile_items_threshold":5,"unpacked_penalty":20},"risk_levels":{"low":{"max_score":30,"label":"Low Risk Move","color":"#10b981","icon":"‚úÖ","message":"Your move looks straightforward!"},"medium":{"max_score":60,"label":"Medium Risk Move","color":"#f59e0b","icon":"‚ö†Ô∏è","message":"We recommend extra protection services"},"high":{"max_score":100,"label":"Complex Move","color":"#ef4444","icon":"üî¥","message":"We recommend White Glove service"}}},"crew_availability":{"enabled":true,"show_calendar":true,"available_dates":["2025-11-15","2025-11-16","2025-11-17","2025-11-20","2025-11-21","2025-11-23","2025-11-24","2025-11-27","2025-11-28","2025-12-01","2025-12-02","2025-12-04"],"limited_availability_dates":["2025-11-22","2025-11-29","2025-12-03"],"display_days":14},"smart_upsells":{"enabled":true,"rules":{"extra_mover":{"enabled":true,"trigger_weight_min":1800,"trigger_weight_max":2200,"message":"üí° Your move is close to requiring an extra mover. Adding one more person could reduce your move time by 30%!","benefit":"Faster move, less time charged"},"protection_materials":{"enabled":true,"trigger_no_packing_selected":true,"fragile_item_keywords":["piano","tv","mirror","glass"],"message":"üõ°Ô∏è We noticed you have fragile items. Add protection materials for peace of mind!","benefit":"Prevent damage to valuables"},"packing_service":{"enabled":true,"trigger_item_count":50,"message":"üì¶ With this many items, our packing service could save you days of work!","benefit":"Professional packing in hours, not days"},"insurance_upgrade":{"enabled":true,"trigger_value_estimate":10000,"message":"üîí For moves this size, we strongly recommend full replacement insurance.","benefit":"Complete protection for your belongings"},"white_glove_recommendation":{"enabled":true,"trigger_risk_score":60,"message":"‚≠ê Based on your move complexity, White Glove service ensures everything is handled perfectly.","benefit":"Expert care, zero stress"}}},"ai_enhanced":{"enabled":true,"auto_fill_inventory":true,"home_type_inventory":{"studio":["twin_bed","nightstand","sofa_2seat","coffee_table","tv_small","desk_small","small_box:15","medium_box:10"],"one_bedroom":["queen_bed","nightstand:2","dresser_small","sofa_3seat","coffee_table","tv_stand","tv_medium","dining_table_small","dining_chair:2","desk_small","small_box:20","medium_box:15","large_box:10"],"two_bedroom":["queen_bed","full_bed","nightstand:3","dresser_large","sofa_3seat","armchair","coffee_table","end_table:2","tv_stand","tv_large","dining_table_large","dining_chair:4","desk_large","bookshelf_large","small_box:30","medium_box:25","large_box:15"],"three_bedroom":["king_bed","queen_bed","twin_bed","nightstand:4","dresser_large:2","sofa_3seat","loveseat","armchair","coffee_table","end_table:2","entertainment_center","tv_large","dining_table_large","dining_chair:6","desk_large","bookshelf_large:2","small_box:45","medium_box:35","large_box:25"],"four_bedroom":["king_bed","queen_bed:2","twin_bed","nightstand:5","dresser_large:3","sofa_3seat","loveseat","armchair:2","coffee_table","end_table:3","entertainment_center","tv_large:2","dining_table_large","dining_chair:8","desk_large:2","bookshelf_large:3","filing_cabinet_4drawer","small_box:60","medium_box:50","large_box:35"]}}};
    </script>

    <!-- Scripts (embedded to avoid CDN issues) -->
    <script src="calculator-script.js"></script>

    <!-- FALLBACK: If external script fails to load, use embedded version -->
    <script>
    // Check if script loaded, if not we'll know the external file didn't work
    if (typeof initializeUI === 'undefined') {
        console.log('Loading embedded fallback script...');
        // The full script will be embedded here if needed
        window.location.href = 'calculator.html?embedded=true';
    }
    </script>


    <!-- Embedded Data -->
    <script>
        window.EMBEDDED_INVENTORY = {"categories":{"living_room":{"name":"Living Room","items":{"sofa_3seat":{"name":"Sofa (3-seat)","weight":350,"icon":"üõãÔ∏è"},"sofa_2seat":{"name":"Loveseat (2-seat)","weight":224,"icon":"üõãÔ∏è"},"armchair":{"name":"Armchair","weight":100,"icon":"ü™ë"},"recliner":{"name":"Recliner","weight":150,"icon":"ü™ë"},"coffee_table":{"name":"Coffee Table","weight":75,"icon":"‚òï"},"end_table":{"name":"End Table","weight":35,"icon":"ü™î"},"tv_stand":{"name":"TV Stand","weight":85,"icon":"üì∫"},"entertainment_center":{"name":"Entertainment Center","weight":250,"icon":"üì∫"},"bookshelf_small":{"name":"Bookshelf (Small)","weight":70,"icon":"üìö"},"bookshelf_large":{"name":"Bookshelf (Large)","weight":150,"icon":"üìö"},"lamp_floor":{"name":"Floor Lamp","weight":25,"icon":"üí°"},"lamp_table":{"name":"Table Lamp","weight":10,"icon":"üí°"}}},"bedroom":{"name":"Bedroom","items":{"king_bed":{"name":"King Bed (frame + mattress)","weight":350,"icon":"üõèÔ∏è"},"queen_bed":{"name":"Queen Bed (frame + mattress)","weight":300,"icon":"üõèÔ∏è"},"full_bed":{"name":"Full Bed (frame + mattress)","weight":250,"icon":"üõèÔ∏è"},"twin_bed":{"name":"Twin Bed (frame + mattress)","weight":175,"icon":"üõèÔ∏è"},"bunk_bed":{"name":"Bunk Bed","weight":300,"icon":"üõèÔ∏è"},"nightstand":{"name":"Nightstand","weight":50,"icon":"üïØÔ∏è"},"dresser_small":{"name":"Dresser (3-4 drawers)","weight":150,"icon":"üóÑÔ∏è"},"dresser_large":{"name":"Dresser (6+ drawers)","weight":250,"icon":"üóÑÔ∏è"},"chest_of_drawers":{"name":"Chest of Drawers","weight":175,"icon":"üóÑÔ∏è"},"wardrobe":{"name":"Wardrobe/Armoire","weight":300,"icon":"üëó"},"mirror_large":{"name":"Large Mirror","weight":50,"icon":"ü™û"},"vanity":{"name":"Vanity Table","weight":125,"icon":"üíÑ"}}},"dining":{"name":"Dining Room","items":{"dining_table_small":{"name":"Dining Table (4-seater)","weight":150,"icon":"üçΩÔ∏è"},"dining_table_large":{"name":"Dining Table (6+ seater)","weight":250,"icon":"üçΩÔ∏è"},"dining_chair":{"name":"Dining Chair","weight":35,"icon":"ü™ë"},"bench":{"name":"Dining Bench","weight":75,"icon":"ü™ë"},"china_cabinet":{"name":"China Cabinet","weight":300,"icon":"üóÑÔ∏è"},"buffet":{"name":"Buffet/Sideboard","weight":200,"icon":"üóÑÔ∏è"},"bar_cart":{"name":"Bar Cart","weight":50,"icon":"üç∑"}}},"office":{"name":"Office/Study","items":{"desk_small":{"name":"Desk (Small)","weight":100,"icon":"üñ•Ô∏è"},"desk_large":{"name":"Desk (Large/Executive)","weight":200,"icon":"üñ•Ô∏è"},"office_chair":{"name":"Office Chair","weight":50,"icon":"ü™ë"},"filing_cabinet_2drawer":{"name":"Filing Cabinet (2-drawer)","weight":75,"icon":"üóÑÔ∏è"},"filing_cabinet_4drawer":{"name":"Filing Cabinet (4-drawer)","weight":150,"icon":"üóÑÔ∏è"},"bookshelf_office":{"name":"Office Bookshelf","weight":125,"icon":"üìö"},"computer_desk":{"name":"Computer Desk","weight":125,"icon":"üíª"}}},"appliances":{"name":"Appliances","items":{"refrigerator":{"name":"Refrigerator","weight":300,"icon":"üßä"},"freezer":{"name":"Freezer (Upright)","weight":250,"icon":"‚ùÑÔ∏è"},"washer":{"name":"Washing Machine","weight":200,"icon":"üß∫"},"dryer":{"name":"Dryer","weight":150,"icon":"üß∫"},"dishwasher":{"name":"Dishwasher","weight":175,"icon":"üçΩÔ∏è"},"stove":{"name":"Stove/Range","weight":250,"icon":"üî•"},"microwave":{"name":"Microwave","weight":50,"icon":"‚è≤Ô∏è"},"tv_small":{"name":"TV (32-42 inch)","weight":35,"icon":"üì∫"},"tv_medium":{"name":"TV (43-55 inch)","weight":50,"icon":"üì∫"},"tv_large":{"name":"TV (55+ inch)","weight":75,"icon":"üì∫"}}},"outdoor":{"name":"Outdoor/Patio","items":{"patio_table":{"name":"Patio Table","weight":100,"icon":"üçΩÔ∏è"},"patio_chair":{"name":"Patio Chair","weight":30,"icon":"ü™ë"},"grill":{"name":"BBQ Grill","weight":150,"icon":"üî•"},"patio_umbrella":{"name":"Patio Umbrella","weight":40,"icon":"‚òÇÔ∏è"},"lawn_mower":{"name":"Lawn Mower","weight":90,"icon":"üå±"},"bike":{"name":"Bicycle","weight":30,"icon":"üö≤"},"exercise_equipment":{"name":"Exercise Equipment","weight":150,"icon":"üèãÔ∏è"}}},"boxes":{"name":"Boxes & Bins","items":{"small_box":{"name":"Small Box (1.5 cu ft)","weight":30,"icon":"üì¶"},"medium_box":{"name":"Medium Box (3 cu ft)","weight":45,"icon":"üì¶"},"large_box":{"name":"Large Box (4.5 cu ft)","weight":60,"icon":"üì¶"},"wardrobe_box":{"name":"Wardrobe Box","weight":25,"icon":"üëî"},"plastic_bin":{"name":"Plastic Storage Bin","weight":35,"icon":"üóÉÔ∏è"}}},"miscellaneous":{"name":"Miscellaneous","items":{"rug_small":{"name":"Rug (Small)","weight":20,"icon":"üé®"},"rug_large":{"name":"Rug (Large)","weight":50,"icon":"üñºÔ∏è"},"piano_upright":{"name":"Upright Piano","weight":600,"icon":"üéπ"},"piano_grand":{"name":"Grand Piano","weight":1200,"icon":"üéπ"},"safe_small":{"name":"Safe (Small)","weight":200,"icon":"üîí"},"safe_large":{"name":"Safe (Large)","weight":500,"icon":"üîí"},"pool_table":{"name":"Pool Table","weight":1000,"icon":"üé±"},"mattress_only":{"name":"Mattress Only (Queen)","weight":150,"icon":"üõèÔ∏è"}}}},"ai_estimation_defaults":{"studio":{"weight":2000,"cubic_feet":285,"typical_items":25},"one_bedroom":{"weight":3500,"cubic_feet":500,"typical_items":40},"two_bedroom":{"weight":5500,"cubic_feet":785,"typical_items":65},"three_bedroom":{"weight":8000,"cubic_feet":1142,"typical_items":95},"four_bedroom":{"weight":10500,"cubic_feet":1500,"typical_items":125},"five_bedroom_plus":{"weight":13000,"cubic_feet":1857,"typical_items":155}},"multipliers":{"stairs_per_floor":1.15,"elevator_available":0.95,"long_walk":1.1,"packing_required":1.3,"fragile_items":1.2}};

        window.EMBEDDED_CONFIG = {"company":{"name":"Your Moving Company","phone":"(555) 123-4567","email":"info@yourmovingcompany.com","website":"https://yourmovingcompany.com","logo_url":"","brand_color":"#3b82f6"},"pricing":{"labor":{"hourly_rate_per_mover":45,"allow_customer_to_edit_rate":false,"minimum_hours":2,"overtime_rate_multiplier":1.5,"overtime_starts_after_hours":8},"crew":{"default_movers":2,"auto_calculate_crew":true,"crew_sizing":{"0_500_lbs":1,"501_2000_lbs":2,"2001_5000_lbs":3,"5001_8000_lbs":4,"8001_plus_lbs":5}},"trucks":{"10ft":{"max_cubic_feet":400,"max_weight":2800,"daily_rate":89,"hourly_rate":0,"name":"10ft Truck (Studio/Small 1BR)"},"16ft":{"max_cubic_feet":800,"max_weight":5600,"daily_rate":129,"hourly_rate":0,"name":"16ft Truck (1-2 BR Apartment)"},"20ft":{"max_cubic_feet":1000,"max_weight":7000,"daily_rate":169,"hourly_rate":0,"name":"20ft Truck (2-3 BR House)"},"26ft":{"max_cubic_feet":1500,"max_weight":10000,"daily_rate":199,"hourly_rate":0,"name":"26ft Truck (3+ BR House)"}},"fees":{"fuel_surcharge_per_mile":2.00,"truck_equipment_fee":150,"start_cost_per_mile":5.00,"start_cost_applies_to_first_miles":10,"regular_cost_per_mile_after_start":2.50,"optional_fees":{"stairs_per_flight":50,"long_carry_per_50ft":35,"elevator_wait_per_30min":40,"packing_service_per_hour":60,"assembly_disassembly_per_item":25,"appliance_disconnect_reconnect":75,"piano_moving_upright":200,"piano_moving_grand":400,"storage_first_month":150}},"distance_pricing":{"local_max_miles":50,"local_pricing_mode":"hourly","long_distance_min_miles":51,"long_distance_base_rate":500,"long_distance_per_mile":3.50,"long_distance_includes_loading_unloading":true},"calculation_settings":{"pounds_to_cubic_feet_divisor":7,"loading_rate_lbs_per_mover_per_hour":1000,"unloading_rate_lbs_per_mover_per_hour":1200,"average_truck_speed_mph":45,"cost_range_low_multiplier":0.90,"cost_range_high_multiplier":1.15,"packing_time_multiplier":1.3,"stairs_time_multiplier":1.15,"fragile_items_time_multiplier":1.2},"dynamic_pricing":{"enabled":true,"peak_season":{"enabled":true,"months":[5,6,7,8,9],"multiplier":1.20,"description":"Peak moving season (May-Sep)"},"weekend_pricing":{"enabled":true,"days":[0,6],"multiplier":1.15,"description":"Weekend moves (Sat/Sun)"},"month_end":{"enabled":true,"days":[1,28,29,30,31],"multiplier":1.25,"description":"First/last of month rush"},"holidays":{"enabled":true,"multiplier":1.30,"dates":["2024-07-04","2024-09-02","2024-11-28"],"description":"Holiday pricing"},"rush_move":{"enabled":true,"within_days":3,"multiplier":1.50,"description":"Rush move (within 3 days)"}},"add_on_services":{"packing_materials":{"enabled":true,"name":"Packing Materials Kit","description":"Complete packing supplies delivered","auto_calculate":true,"items":{"small_box":{"name":"Small Box","price":2.50,"per_bedroom":5},"medium_box":{"name":"Medium Box","price":3.00,"per_bedroom":10},"large_box":{"name":"Large Box","price":3.50,"per_bedroom":8},"wardrobe_box":{"name":"Wardrobe Box","price":8.00,"per_bedroom":2},"bubble_wrap":{"name":"Bubble Wrap Roll","price":12.00,"per_move":2},"packing_tape":{"name":"Packing Tape","price":4.00,"per_move":3},"markers":{"name":"Markers","price":3.00,"per_move":1}}},"insurance":{"enabled":true,"name":"Moving Insurance","description":"Protect your belongings","options":[{"level":"basic","name":"Basic Coverage ($0.60/lb)","rate_per_pound":0.60,"max_coverage":5000,"price_calculation":"weight"},{"level":"premium","name":"Full Replacement Value","base_price":150,"per_1000_value":5,"description":"Full replacement cost coverage"}]},"assembly":{"enabled":true,"name":"Furniture Assembly/Disassembly","price_per_item":25,"description":"Professional assembly service","common_items":["Bed Frame","Desk","Bookshelf","Dining Table","TV Stand"]},"storage":{"enabled":true,"name":"Climate-Controlled Storage","first_month_price":0,"regular_monthly_price":150,"promotion":"First month FREE","description":"Secure, climate-controlled storage"},"junk_removal":{"enabled":true,"name":"Junk Removal Service","price_per_item":35,"truck_load_price":250,"description":"We'll haul away unwanted items"},"cleaning":{"enabled":true,"name":"Move-Out Cleaning","studio_1br":150,"2br":225,"3br":300,"4br_plus":400,"description":"Professional deep cleaning"}}},"lead_capture":{"require_email":true,"require_phone":false,"show_partial_estimate_first":true,"partial_estimate_shows":{"cost_range":true,"truck_size":true,"crew_size":true,"labor_hours":false,"breakdown":false},"full_estimate_requires_email":true},"integrations":{"webhook":{"enabled":false,"url":"https://hooks.zapier.com/hooks/catch/YOUR_WEBHOOK_ID/","method":"POST","include_inventory_list":true,"send_on_partial_view":false,"send_on_full_view":true},"zapier":{"enabled":false,"webhook_url":"","instructions":"Create a Zap with 'Webhooks by Zapier' trigger, then paste the webhook URL above"},"trello":{"enabled":false,"api_key":"","token":"","board_id":"","list_id":"","instructions":"Get API credentials from https://trello.com/app-key"},"hubspot":{"enabled":false,"api_key":"","instructions":"Add your HubSpot API key to create deals automatically"},"email":{"enabled":false,"service":"mailto","smtp_instructions":"For production, use a service like SendGrid, Mailgun, or AWS SES"},"sms":{"enabled":false,"twilio_account_sid":"","twilio_auth_token":"","twilio_phone_number":"","instructions":"Add Twilio credentials to enable 'Text me this quote' feature"}},"social_proof":{"enabled":true,"total_customers_this_month":2847,"total_reviews":1200,"average_rating":4.9,"recent_bookings":[{"name":"Sarah","location":"Chicago","minutes_ago":12},{"name":"Mike","location":"Austin","minutes_ago":45},{"name":"Jennifer","location":"Seattle","minutes_ago":67}],"trust_badges":["Licensed & Insured","5-Star Rated","Family Owned"]},"competitor_comparison":{"enabled":true,"industry_average_multiplier":1.27,"show_savings_badge":true,"competitor_names":["Industry Average","Typical Moving Company"]},"tip_calculator":{"enabled":true,"suggested_percentage_low":15,"suggested_percentage_high":20,"show_in_final_results":true,"description":"Industry standard is 15-20% of labor cost or $20-40 per mover"},"referral_program":{"enabled":true,"discount_amount":100,"description":"Refer a friend, you both get $100 off","code_prefix":"REF","show_after_quote":true},"moving_checklist":{"enabled":true,"generate_pdf":true,"items":[{"weeks_before":4,"task":"Reserve elevator and get parking permits"},{"weeks_before":3,"task":"Start decluttering and donate unwanted items"},{"weeks_before":2,"task":"Begin packing non-essential items"},{"weeks_before":1,"task":"Confirm move date and details with company"},{"days_before":3,"task":"Pack essential bag for moving day"},{"days_before":1,"task":"Defrost refrigerator and prepare appliances"},{"moving_day":true,"task":"Have cash/tip ready for movers"}]},"ui_settings":{"theme":{"primary_color":"#3b82f6","secondary_color":"#10b981","accent_color":"#f59e0b","dark_mode_available":true,"default_dark_mode":false},"branding":{"show_powered_by":true,"powered_by_text":"Powered by RoutineMoves","powered_by_url":"https://routinemoves.ai","custom_footer_text":""},"features":{"enable_inventory_mode":true,"enable_ai_quick_estimate":true,"enable_pdf_export":true,"enable_email_quote":true,"enable_sms_quote":false,"enable_admin_mode":true,"show_cost_breakdown":true,"show_tips_and_recommendations":true,"enable_dynamic_pricing":true,"enable_add_on_services":true,"enable_social_proof":true,"enable_competitor_comparison":true,"enable_tip_calculator":true,"enable_referral_program":true,"enable_moving_checklist":true}},"admin_mode":{"enabled":true,"password":"admin123","instructions":"Add ?admin=true to URL and enter password to test without lead capture"},"booking":{"enabled":true,"phone":"(555) 123-4567","book_now_url":"https://yourmovingcompany.com/book","calendar_url":"","show_call_button":true,"show_book_button":true,"cta_text_urgent":"Book Now - Limited Availability!","cta_text_normal":"Book Your Move Today"},"three_tier_pricing":{"enabled":true,"tiers":{"saver":{"name":"Saver","multiplier":0.85,"description":"Basic service - great value","features":["Professional movers","Basic equipment included","Standard insurance coverage"]},"standard":{"name":"Standard","multiplier":1.0,"description":"Most popular choice","recommended":true,"features":["Professional movers","Full equipment & padding","Enhanced insurance coverage","Furniture protection"]},"white_glove":{"name":"White Glove","multiplier":1.35,"description":"Premium service","features":["Expert white-glove movers","Premium equipment & materials","Full replacement insurance","Complete furniture protection","Unpacking & setup service","Same-day assembly"]}}},"move_risk_score":{"enabled":true,"factors":{"weight_threshold_high":8000,"stairs_high_risk":3,"long_distance_threshold":100,"fragile_items_threshold":5,"unpacked_penalty":20},"risk_levels":{"low":{"max_score":30,"label":"Low Risk Move","color":"#10b981","icon":"‚úÖ","message":"Your move looks straightforward!"},"medium":{"max_score":60,"label":"Medium Risk Move","color":"#f59e0b","icon":"‚ö†Ô∏è","message":"We recommend extra protection services"},"high":{"max_score":100,"label":"Complex Move","color":"#ef4444","icon":"üî¥","message":"We recommend White Glove service"}}},"crew_availability":{"enabled":true,"show_calendar":true,"available_dates":["2025-11-15","2025-11-16","2025-11-17","2025-11-20","2025-11-21","2025-11-23","2025-11-24","2025-11-27","2025-11-28","2025-12-01","2025-12-02","2025-12-04"],"limited_availability_dates":["2025-11-22","2025-11-29","2025-12-03"],"display_days":14},"smart_upsells":{"enabled":true,"rules":{"extra_mover":{"enabled":true,"trigger_weight_min":1800,"trigger_weight_max":2200,"message":"üí° Your move is close to requiring an extra mover. Adding one more person could reduce your move time by 30%!","benefit":"Faster move, less time charged"},"protection_materials":{"enabled":true,"trigger_no_packing_selected":true,"fragile_item_keywords":["piano","tv","mirror","glass"],"message":"üõ°Ô∏è We noticed you have fragile items. Add protection materials for peace of mind!","benefit":"Prevent damage to valuables"},"packing_service":{"enabled":true,"trigger_item_count":50,"message":"üì¶ With this many items, our packing service could save you days of work!","benefit":"Professional packing in hours, not days"},"insurance_upgrade":{"enabled":true,"trigger_value_estimate":10000,"message":"üîí For moves this size, we strongly recommend full replacement insurance.","benefit":"Complete protection for your belongings"},"white_glove_recommendation":{"enabled":true,"trigger_risk_score":60,"message":"‚≠ê Based on your move complexity, White Glove service ensures everything is handled perfectly.","benefit":"Expert care, zero stress"}}},"ai_enhanced":{"enabled":true,"auto_fill_inventory":true,"home_type_inventory":{"studio":["twin_bed","nightstand","sofa_2seat","coffee_table","tv_small","desk_small","small_box:15","medium_box:10"],"one_bedroom":["queen_bed","nightstand:2","dresser_small","sofa_3seat","coffee_table","tv_stand","tv_medium","dining_table_small","dining_chair:2","desk_small","small_box:20","medium_box:15","large_box:10"],"two_bedroom":["queen_bed","full_bed","nightstand:3","dresser_large","sofa_3seat","armchair","coffee_table","end_table:2","tv_stand","tv_large","dining_table_large","dining_chair:4","desk_large","bookshelf_large","small_box:30","medium_box:25","large_box:15"],"three_bedroom":["king_bed","queen_bed","twin_bed","nightstand:4","dresser_large:2","sofa_3seat","loveseat","armchair","coffee_table","end_table:2","entertainment_center","tv_large","dining_table_large","dining_chair:6","desk_large","bookshelf_large:2","small_box:45","medium_box:35","large_box:25"],"four_bedroom":["king_bed","queen_bed:2","twin_bed","nightstand:5","dresser_large:3","sofa_3seat","loveseat","armchair:2","coffee_table","end_table:3","entertainment_center","tv_large:2","dining_table_large","dining_chair:8","desk_large:2","bookshelf_large:3","filing_cabinet_4drawer","small_box:60","medium_box:50","large_box:35"]}}};
    </script>

    <!-- Embedded Script -->
    <script>
/* ============================================
   MOVING COST CALCULATOR - JAVASCRIPT
   Full calculation engine with lead capture
   ============================================ */

// Global State
let inventory = {};
let config = {};
let selectedItems = {}; // { item_key: quantity }
let calculationResults = null;
let leadData = null;
let isAdminMode = false;

// ============================================
// INITIALIZATION
// ============================================

document.addEventListener('DOMContentLoaded', async () => {
    // Check for admin mode
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('admin') === 'true') {
        const password = prompt('Enter admin password:');
        if (password === config.admin_mode?.password || password === 'admin123') {
            isAdminMode = true;
            console.log('üîì Admin mode activated');
        }
    }

    // Load data files
    await loadInventory();
    await loadConfig();

    // Initialize UI
    initializeUI();
    setupEventListeners();
    loadDarkModePreference();

    console.log('‚úÖ Moving Cost Calculator initialized');
});

// ============================================
// LOAD DATA FILES
// ============================================

async function loadInventory() {
    try {
        // Use embedded data if available (avoids CDN/CORS issues)
        if (window.EMBEDDED_INVENTORY) {
            inventory = window.EMBEDDED_INVENTORY;
            console.log('‚úÖ Inventory loaded from embedded data:', Object.keys(inventory.categories).length, 'categories');
        } else {
            // Fallback to fetch if embedded data not available
            const response = await fetch('inventory.json');
            inventory = await response.json();
            console.log('‚úÖ Inventory loaded from file:', Object.keys(inventory.categories).length, 'categories');
        }
    } catch (error) {
        console.error('‚ùå Error loading inventory:', error);
        alert('Error loading inventory data. Please refresh the page.');
    }
}

async function loadConfig() {
    try {
        // Use embedded data if available (avoids CDN/CORS issues)
        if (window.EMBEDDED_CONFIG) {
            config = window.EMBEDDED_CONFIG;
            console.log('‚úÖ Config loaded from embedded data');
        } else {
            // Fallback to fetch if embedded data not available
            const response = await fetch('config.json');
            config = await response.json();
            console.log('‚úÖ Config loaded from file');
        }

        // Apply config to UI
        applyConfigToUI();
    } catch (error) {
        console.error('‚ùå Error loading config:', error);
        alert('Error loading configuration. Please refresh the page.');
    }
}

function applyConfigToUI() {
    // Set hourly rate
    if (config.pricing?.labor?.hourly_rate_per_mover) {
        document.getElementById('hourlyRate').value = config.pricing.labor.hourly_rate_per_mover;

        // Lock hourly rate if not allowed to edit
        if (config.pricing.labor.allow_customer_to_edit_rate === false) {
            const hourlyRateInput = document.getElementById('hourlyRate');
            hourlyRateInput.disabled = true;
            hourlyRateInput.style.backgroundColor = 'var(--bg-tertiary)';
            hourlyRateInput.style.cursor = 'not-allowed';

            // Update label to show it's locked
            const label = document.querySelector('label[for="hourlyRate"]');
            if (label) {
                label.innerHTML = 'Hourly Rate per Mover ($) <span style="color: var(--text-tertiary); font-size: 0.85rem;">‚Ä¢ Set by company</span>';
            }
        }
    }

    // Set branding
    if (config.ui_settings?.branding) {
        const branding = config.ui_settings.branding;
        if (branding.show_powered_by && branding.powered_by_text) {
            document.getElementById('brandingText').innerHTML =
                `${branding.powered_by_text} ${branding.powered_by_url ? `<a href="${branding.powered_by_url}" target="_blank">RoutineMoves</a>` : ''}`;
        }
    }

    // Apply primary color
    if (config.ui_settings?.theme?.primary_color) {
        document.documentElement.style.setProperty('--primary-color', config.ui_settings.theme.primary_color);
    }
}

// ============================================
// UI INITIALIZATION
// ============================================

function initializeUI() {
    renderInventoryCategories();
    updateInventorySummary();
}

function renderInventoryCategories() {
    const container = document.getElementById('inventoryCategories');
    container.innerHTML = '';

    Object.entries(inventory.categories).forEach(([categoryKey, category]) => {
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'inventory-category';
        categoryDiv.innerHTML = `
            <div class="category-header" data-category="${categoryKey}">
                <span class="category-title">${category.name}</span>
                <span class="category-toggle">‚ñº</span>
            </div>
            <div class="category-items" id="category-${categoryKey}">
                ${renderCategoryItems(category.items, categoryKey)}
            </div>
        `;
        container.appendChild(categoryDiv);
    });

    // Add category toggle listeners
    document.querySelectorAll('.category-header').forEach(header => {
        header.addEventListener('click', toggleCategory);
    });
}

function renderCategoryItems(items, categoryKey) {
    return Object.entries(items).map(([itemKey, item]) => {
        const fullKey = `${categoryKey}_${itemKey}`;
        const quantity = selectedItems[fullKey] || 0;

        return `
            <div class="inventory-item" data-item="${fullKey}">
                <div class="item-icon">${item.icon}</div>
                <div class="item-info">
                    <span class="item-name">${item.name}</span>
                    <span class="item-weight">${item.weight} lbs</span>
                </div>
                <div class="item-controls">
                    <button class="item-btn item-minus" data-item="${fullKey}" ${quantity === 0 ? 'disabled' : ''}>‚àí</button>
                    <span class="item-count">${quantity}</span>
                    <button class="item-btn item-plus" data-item="${fullKey}">+</button>
                </div>
            </div>
        `;
    }).join('');
}

function toggleCategory(e) {
    const header = e.currentTarget;
    const categoryKey = header.dataset.category;
    const itemsContainer = document.getElementById(`category-${categoryKey}`);

    header.classList.toggle('active');
    itemsContainer.classList.toggle('active');
}

// ============================================
// EVENT LISTENERS
// ============================================

function setupEventListeners() {
    // Mode switcher
    document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', switchMode);
    });

    // Inventory item controls
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('item-plus')) {
            updateItemQuantity(e.target.dataset.item, 1);
        } else if (e.target.classList.contains('item-minus')) {
            updateItemQuantity(e.target.dataset.item, -1);
        }
    });

    // AI Estimate button
    document.getElementById('aiEstimateBtn').addEventListener('click', generateAIEstimate);

    // Calculate button
    document.getElementById('calculateBtn').addEventListener('click', calculateEstimate);

    // Lead capture form
    document.getElementById('leadCaptureForm').addEventListener('submit', handleLeadCapture);

    // Action buttons
    document.getElementById('downloadPdfBtn')?.addEventListener('click', downloadPDF);
    document.getElementById('emailQuoteBtn')?.addEventListener('click', emailQuote);
    document.getElementById('textQuoteBtn')?.addEventListener('click', textQuote);
    document.getElementById('startOverBtn')?.addEventListener('click', startOver);

    // Dark mode toggle
    document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);
}

// ============================================
// MODE SWITCHING
// ============================================

function switchMode(e) {
    const mode = e.target.dataset.mode;

    // Update buttons
    document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    e.target.classList.add('active');

    // Update content
    document.querySelectorAll('.mode-content').forEach(content => {
        content.classList.remove('active');
    });
    document.getElementById(`${mode}Mode`).classList.add('active');

    // Reset progress
    updateProgress(1);
}

// ============================================
// INVENTORY MANAGEMENT
// ============================================

function updateItemQuantity(itemKey, change) {
    if (!selectedItems[itemKey]) {
        selectedItems[itemKey] = 0;
    }

    selectedItems[itemKey] += change;

    if (selectedItems[itemKey] < 0) {
        selectedItems[itemKey] = 0;
    }

    // Re-render the specific item
    const itemElement = document.querySelector(`[data-item="${itemKey}"]`);
    if (itemElement) {
        const count = itemElement.querySelector('.item-count');
        const minusBtn = itemElement.querySelector('.item-minus');

        count.textContent = selectedItems[itemKey];
        minusBtn.disabled = selectedItems[itemKey] === 0;
    }

    updateInventorySummary();

    // Show move details section if items selected
    if (getTotalItems() > 0) {
        document.getElementById('moveDetailsSection').style.display = 'block';
        updateProgress(2);
    } else {
        document.getElementById('moveDetailsSection').style.display = 'none';
        updateProgress(1);
    }
}

function updateInventorySummary() {
    const totalItems = getTotalItems();
    const totalWeight = getTotalWeight();
    const totalCubicFeet = weightToCubicFeet(totalWeight);

    document.getElementById('totalItems').textContent = totalItems;
    document.getElementById('totalWeight').textContent = `${totalWeight.toLocaleString()} lbs`;
    document.getElementById('totalCubicFeet').textContent = `${Math.round(totalCubicFeet)} cu ft`;
}

function getTotalItems() {
    return Object.values(selectedItems).reduce((sum, qty) => sum + qty, 0);
}

function getTotalWeight() {
    let total = 0;

    Object.entries(selectedItems).forEach(([itemKey, quantity]) => {
        const [categoryKey, itemName] = itemKey.split('_');
        const item = inventory.categories[categoryKey]?.items[itemName];
        if (item) {
            total += item.weight * quantity;
        }
    });

    return total;
}

function weightToCubicFeet(weight) {
    const divisor = config.pricing?.calculation_settings?.pounds_to_cubic_feet_divisor || 7;
    return weight / divisor;
}

// ============================================
// AI ESTIMATION
// ============================================

function generateAIEstimate() {
    const input = document.getElementById('aiInput').value.trim();

    if (!input) {
        alert('Please describe your move first');
        return;
    }

    showLoading();

    // Simulate AI processing
    setTimeout(() => {
        const parsed = parseAIInput(input);
        displayAIParsedResults(parsed);

        // Pre-fill form values
        if (parsed.distance) {
            document.getElementById('distance').value = parsed.distance;
        }
        if (parsed.stairs) {
            document.getElementById('stairs').value = parsed.stairs;
        }

        // Show move details section
        document.getElementById('moveDetailsSection').style.display = 'block';
        document.getElementById('aiParsedResults').style.display = 'block';

        hideLoading();
        updateProgress(2);
    }, 1500);
}

function parseAIInput(input) {
    const lower = input.toLowerCase();
    const parsed = {
        homeSize: null,
        weight: 0,
        cubicFeet: 0,
        distance: null,
        stairs: 0,
        packing: false,
        detected: []
    };

    // Detect home size
    if (lower.includes('studio')) {
        parsed.homeSize = 'studio';
        const defaults = inventory.ai_estimation_defaults.studio;
        parsed.weight = defaults.weight;
        parsed.cubicFeet = defaults.cubic_feet;
        parsed.detected.push(`Studio apartment (${defaults.weight} lbs estimated)`);
    } else if (lower.match(/1[\s-]?bed|one[\s-]?bed/)) {
        parsed.homeSize = 'one_bedroom';
        const defaults = inventory.ai_estimation_defaults.one_bedroom;
        parsed.weight = defaults.weight;
        parsed.cubicFeet = defaults.cubic_feet;
        parsed.detected.push(`1-bedroom apartment (${defaults.weight} lbs estimated)`);
    } else if (lower.match(/2[\s-]?bed|two[\s-]?bed/)) {
        parsed.homeSize = 'two_bedroom';
        const defaults = inventory.ai_estimation_defaults.two_bedroom;
        parsed.weight = defaults.weight;
        parsed.cubicFeet = defaults.cubic_feet;
        parsed.detected.push(`2-bedroom apartment (${defaults.weight} lbs estimated)`);
    } else if (lower.match(/3[\s-]?bed|three[\s-]?bed/)) {
        parsed.homeSize = 'three_bedroom';
        const defaults = inventory.ai_estimation_defaults.three_bedroom;
        parsed.weight = defaults.weight;
        parsed.cubicFeet = defaults.cubic_feet;
        parsed.detected.push(`3-bedroom house (${defaults.weight} lbs estimated)`);
    } else if (lower.match(/4[\s-]?bed|four[\s-]?bed/)) {
        parsed.homeSize = 'four_bedroom';
        const defaults = inventory.ai_estimation_defaults.four_bedroom;
        parsed.weight = defaults.weight;
        parsed.cubicFeet = defaults.cubic_feet;
        parsed.detected.push(`4-bedroom house (${defaults.weight} lbs estimated)`);
    } else if (lower.match(/5[\s-]?bed|five[\s-]?bed/)) {
        parsed.homeSize = 'five_bedroom_plus';
        const defaults = inventory.ai_estimation_defaults.five_bedroom_plus;
        parsed.weight = defaults.weight;
        parsed.cubicFeet = defaults.cubic_feet;
        parsed.detected.push(`5+ bedroom house (${defaults.weight} lbs estimated)`);
    }

    // Detect distance
    const distanceMatch = lower.match(/(\d+)\s*(mile|mi)/);
    if (distanceMatch) {
        parsed.distance = parseInt(distanceMatch[1]);
        parsed.detected.push(`Distance: ${parsed.distance} miles`);
    }

    // Detect stairs
    if (lower.match(/no\s*elevator|stairs/)) {
        const floorMatch = lower.match(/(\d+)(st|nd|rd|th)\s*floor/);
        if (floorMatch) {
            parsed.stairs = Math.min(3, parseInt(floorMatch[1]) - 1);
            parsed.detected.push(`${floorMatch[1]}${floorMatch[2]} floor (stairs)`);
        } else {
            parsed.stairs = 1;
            parsed.detected.push('Stairs detected');
        }
    }

    // Detect packing
    if (lower.match(/packing|pack\s*for\s*me|need\s*boxes/)) {
        parsed.packing = true;
        parsed.detected.push('Packing service requested');
    }

    return parsed;
}

function displayAIParsedResults(parsed) {
    const list = document.getElementById('aiDetectedList');
    list.innerHTML = parsed.detected.map(item => `<li>‚úì ${item}</li>`).join('');

    // Store AI estimation in a temporary state
    window.aiEstimation = {
        weight: parsed.weight,
        cubicFeet: parsed.cubicFeet
    };
}

// ============================================
// COST CALCULATION
// ============================================

function calculateEstimate() {
    showLoading();

    setTimeout(() => {
        // Get inputs
        const distance = parseFloat(document.getElementById('distance').value) || 10;
        const numMoversInput = document.getElementById('numMovers').value;
        const hourlyRate = parseFloat(document.getElementById('hourlyRate').value) || 45;
        const stairs = parseInt(document.getElementById('stairs').value) || 0;
        const packingService = document.getElementById('packingService').checked;
        const longCarry = document.getElementById('longCarry').checked;

        // Get weight (from inventory or AI)
        let totalWeight = getTotalWeight();
        let totalCubicFeet = weightToCubicFeet(totalWeight);

        // If using AI mode and no inventory selected, use AI estimation
        if (totalWeight === 0 && window.aiEstimation) {
            totalWeight = window.aiEstimation.weight;
            totalCubicFeet = window.aiEstimation.cubicFeet;
        }

        if (totalWeight === 0) {
            alert('Please select items or use AI estimation first');
            hideLoading();
            return;
        }

        // Calculate crew size
        const numMovers = numMoversInput === 'auto'
            ? calculateCrewSize(totalWeight)
            : parseInt(numMoversInput);

        // Calculate truck size
        const truckSizeInput = document.getElementById('truckSize').value;
        const truckInfo = truckSizeInput === 'auto'
            ? calculateTruckSize(totalCubicFeet)
            : getManualTruckInfo(truckSizeInput);

        // Calculate labor time
        const loadingRate = config.pricing?.calculation_settings?.loading_rate_lbs_per_mover_per_hour || 1000;
        const unloadingRate = config.pricing?.calculation_settings?.unloading_rate_lbs_per_mover_per_hour || 1200;
        const truckSpeed = config.pricing?.calculation_settings?.average_truck_speed_mph || 45;

        let loadTime = totalWeight / (loadingRate * numMovers);
        let unloadTime = totalWeight / (unloadingRate * numMovers);
        let driveTime = distance / truckSpeed;

        // Apply multipliers
        if (stairs > 0) {
            const stairsMultiplier = config.pricing?.calculation_settings?.stairs_time_multiplier || 1.15;
            loadTime *= Math.pow(stairsMultiplier, stairs);
            unloadTime *= Math.pow(stairsMultiplier, stairs);
        }

        if (packingService) {
            const packingMultiplier = config.pricing?.calculation_settings?.packing_time_multiplier || 1.3;
            loadTime *= packingMultiplier;
        }

        const totalHours = loadTime + unloadTime + driveTime;

        // Calculate costs
        const laborCost = totalHours * numMovers * hourlyRate;
        const truckFee = truckInfo.daily_rate;
        const truckEquipmentFee = config.pricing?.fees?.truck_equipment_fee || 150;

        // Fuel surcharge
        const fuelSurcharge = distance * (config.pricing?.fees?.fuel_surcharge_per_mile || 2.00);

        // Start cost per mile
        const startCostMiles = config.pricing?.fees?.start_cost_applies_to_first_miles || 10;
        const startCostPerMile = config.pricing?.fees?.start_cost_per_mile || 5.00;
        const regularCostPerMile = config.pricing?.fees?.regular_cost_per_mile_after_start || 2.50;

        let distanceCost = 0;
        if (distance <= startCostMiles) {
            distanceCost = distance * startCostPerMile;
        } else {
            distanceCost = (startCostMiles * startCostPerMile) +
                          ((distance - startCostMiles) * regularCostPerMile);
        }

        // Optional fees
        let optionalFees = 0;
        if (stairs > 0) {
            optionalFees += stairs * (config.pricing?.fees?.optional_fees?.stairs_per_flight || 50);
        }
        if (longCarry) {
            optionalFees += config.pricing?.fees?.optional_fees?.long_carry_per_50ft || 35;
        }
        if (packingService) {
            optionalFees += totalHours * (config.pricing?.fees?.optional_fees?.packing_service_per_hour || 60);
        }

        // Apply dynamic pricing
        const dynamicPricing = calculateDynamicPricingMultiplier();

        // Calculate add-ons
        const addOnsTotal = calculateAddOns();

        // Total cost (with dynamic pricing and add-ons)
        let baseCost = laborCost + truckFee + truckEquipmentFee + fuelSurcharge + distanceCost + optionalFees;
        baseCost = baseCost * dynamicPricing.multiplier; // Apply dynamic pricing
        baseCost += addOnsTotal; // Add selected add-ons

        const lowMultiplier = config.pricing?.calculation_settings?.cost_range_low_multiplier || 0.90;
        const highMultiplier = config.pricing?.calculation_settings?.cost_range_high_multiplier || 1.15;

        const costLow = baseCost * lowMultiplier;
        const costHigh = baseCost * highMultiplier;

        // Store results
        calculationResults = {
            totalWeight,
            totalCubicFeet,
            distance,
            numMovers,
            hourlyRate,
            totalHours,
            truckSize: truckInfo.displayName || truckInfo.name,
            truckCount: truckInfo.count,
            truckFee,
            truckEquipmentFee,
            laborCost,
            fuelSurcharge,
            distanceCost,
            optionalFees,
            addOnsTotal,
            dynamicPricingMultiplier: dynamicPricing.multiplier,
            dynamicPricingReasons: dynamicPricing.reasons,
            baseCost,
            costLow,
            costHigh,
            breakdown: {
                'Labor Cost': { detail: `${totalHours.toFixed(1)} hrs √ó ${numMovers} movers √ó $${hourlyRate}/hr`, amount: laborCost },
                'Truck Rental': { detail: truckInfo.count > 1 ? `${truckInfo.count} √ó ${truckInfo.name}` : truckInfo.displayName || truckInfo.name, amount: truckFee },
                'Truck & Equipment Fee': { detail: 'Standard equipment fee', amount: truckEquipmentFee },
                'Fuel Surcharge': { detail: `${distance} miles √ó $${(config.pricing?.fees?.fuel_surcharge_per_mile || 2).toFixed(2)}/mile`, amount: fuelSurcharge },
                'Distance Fee': { detail: `Mileage charges`, amount: distanceCost }
            }
        };

        if (stairs > 0) {
            calculationResults.breakdown['Stairs Fee'] = {
                detail: `${stairs} flight(s)`,
                amount: stairs * (config.pricing?.fees?.optional_fees?.stairs_per_flight || 50)
            };
        }
        if (longCarry) {
            calculationResults.breakdown['Long Carry Fee'] = {
                detail: '50+ ft from truck',
                amount: config.pricing?.fees?.optional_fees?.long_carry_per_50ft || 35
            };
        }
        if (packingService) {
            calculationResults.breakdown['Packing Service'] = {
                detail: `${totalHours.toFixed(1)} hrs √ó $${config.pricing?.fees?.optional_fees?.packing_service_per_hour || 60}/hr`,
                amount: totalHours * (config.pricing?.fees?.optional_fees?.packing_service_per_hour || 60)
            };
        }

        // Display results
        displayPartialResults();
        hideLoading();
        updateProgress(3);

    }, 1000);
}

function calculateCrewSize(weight) {
    const sizing = config.pricing?.crew?.crew_sizing;
    if (!sizing) return 2;

    if (weight <= 500) return sizing['0_500_lbs'] || 1;
    if (weight <= 2000) return sizing['501_2000_lbs'] || 2;
    if (weight <= 5000) return sizing['2001_5000_lbs'] || 3;
    if (weight <= 8000) return sizing['5001_8000_lbs'] || 4;
    return sizing['8001_plus_lbs'] || 5;
}

function calculateTruckSize(cubicFeet) {
    const trucks = config.pricing?.trucks;
    if (!trucks) return { name: '16ft Truck', daily_rate: 129, count: 1 };

    // Single truck sizing
    if (cubicFeet <= 400) {
        return {
            name: trucks['10ft'].name,
            daily_rate: trucks['10ft'].daily_rate,
            count: 1,
            displayName: trucks['10ft'].name
        };
    }
    if (cubicFeet <= 800) {
        return {
            name: trucks['16ft'].name,
            daily_rate: trucks['16ft'].daily_rate,
            count: 1,
            displayName: trucks['16ft'].name
        };
    }
    if (cubicFeet <= 1000) {
        return {
            name: trucks['20ft'].name,
            daily_rate: trucks['20ft'].daily_rate,
            count: 1,
            displayName: trucks['20ft'].name
        };
    }
    if (cubicFeet <= 1500) {
        return {
            name: trucks['26ft'].name,
            daily_rate: trucks['26ft'].daily_rate,
            count: 1,
            displayName: trucks['26ft'].name
        };
    }

    // Multiple trucks needed for large moves
    const maxTruckSize = 1500; // 26ft truck capacity
    const trucksNeeded = Math.ceil(cubicFeet / maxTruckSize);
    const totalRate = trucks['26ft'].daily_rate * trucksNeeded;

    return {
        name: trucks['26ft'].name,
        daily_rate: totalRate,
        count: trucksNeeded,
        displayName: `${trucksNeeded} √ó ${trucks['26ft'].name.split(' ')[0]} Trucks`
    };
}

function getManualTruckInfo(truckSize) {
    const trucks = config.pricing?.trucks;
    if (!trucks) return { name: '16ft Truck', daily_rate: 129, count: 1, displayName: '16ft Truck' };

    const truck = trucks[truckSize];
    if (!truck) return { name: '16ft Truck', daily_rate: 129, count: 1, displayName: '16ft Truck' };

    return {
        name: truck.name,
        daily_rate: truck.daily_rate,
        count: 1,
        displayName: truck.name
    };
}

// ============================================
// DISPLAY RESULTS
// ============================================

function displayPartialResults() {
    document.getElementById('costLow').textContent = `$${Math.round(calculationResults.costLow).toLocaleString()}`;
    document.getElementById('costHigh').textContent = `$${Math.round(calculationResults.costHigh).toLocaleString()}`;
    document.getElementById('truckSize').textContent = calculationResults.truckSize;
    document.getElementById('crewSize').textContent = `${calculationResults.numMovers} Movers`;
    document.getElementById('estTime').textContent = `${calculationResults.totalHours.toFixed(1)} Hours`;

    // Show competitor comparison
    const avgCost = (calculationResults.costLow + calculationResults.costHigh) / 2;
    showCompetitorComparison(avgCost);

    // Show dynamic pricing notice if applicable
    if (calculationResults.dynamicPricingReasons) {
        showDynamicPricingNotice(calculationResults.dynamicPricingReasons);
    }

    // Show partial results, hide move details
    document.getElementById('moveDetailsSection').style.display = 'none';
    document.getElementById('partialResults').style.display = 'block';

    // Scroll to results
    document.getElementById('partialResults').scrollIntoView({ behavior: 'smooth' });
}

function displayFullResults() {
    const results = calculationResults;

    document.getElementById('customerName').textContent = leadData.name;
    document.getElementById('finalCostLow').textContent = `$${Math.round(results.costLow).toLocaleString()}`;
    document.getElementById('finalCostHigh').textContent = `$${Math.round(results.costHigh).toLocaleString()}`;

    // Breakdown table
    const tbody = document.getElementById('breakdownTableBody');
    tbody.innerHTML = Object.entries(results.breakdown).map(([item, data]) => `
        <tr>
            <td><strong>${item}</strong></td>
            <td>${data.detail}</td>
            <td><strong>$${Math.round(data.amount).toLocaleString()}</strong></td>
        </tr>
    `).join('') + `
        <tr style="border-top: 2px solid var(--border-color); font-weight: bold;">
            <td colspan="2">Estimated Total</td>
            <td>$${Math.round(results.costLow).toLocaleString()} ‚Äî $${Math.round(results.costHigh).toLocaleString()}</td>
        </tr>
    `;

    // Move summary
    document.getElementById('moveSummaryContent').innerHTML = `
        <p><strong>Total Weight:</strong> ${Math.round(results.totalWeight).toLocaleString()} lbs</p>
        <p><strong>Total Volume:</strong> ${Math.round(results.totalCubicFeet)} cubic feet</p>
        <p><strong>Distance:</strong> ${results.distance} miles</p>
        <p><strong>Crew Size:</strong> ${results.numMovers} movers</p>
        <p><strong>Estimated Time:</strong> ${results.totalHours.toFixed(1)} hours</p>
        <p><strong>Truck Size:</strong> ${results.truckSize}</p>
    `;

    // Show full results, hide partial
    document.getElementById('partialResults').style.display = 'none';
    document.getElementById('fullResults').style.display = 'block';

    // Scroll to results
    document.getElementById('fullResults').scrollIntoView({ behavior: 'smooth' });

    // Show tip calculator
    showTipCalculator(results.laborCost);

    // Generate referral code
    generateReferralCode();

    // Send to webhook if not admin mode
    if (!isAdminMode) {
        sendToWebhook();
    }
}

// ============================================
// LEAD CAPTURE
// ============================================

function handleLeadCapture(e) {
    e.preventDefault();

    leadData = {
        name: document.getElementById('leadName').value,
        email: document.getElementById('leadEmail').value,
        phone: document.getElementById('leadPhone').value || '',
        timestamp: new Date().toISOString()
    };

    console.log('‚úÖ Lead captured:', leadData);

    // Show full results
    displayFullResults();
}

// ============================================
// WEBHOOK INTEGRATION
// ============================================

async function sendToWebhook() {
    const webhookConfig = config.integrations?.webhook;

    if (!webhookConfig?.enabled || !webhookConfig?.url) {
        console.log('‚ö†Ô∏è Webhook not configured');
        return;
    }

    const payload = {
        timestamp: leadData.timestamp,
        customer: {
            name: leadData.name,
            email: leadData.email,
            phone: leadData.phone
        },
        move_details: {
            distance_miles: calculationResults.distance,
            cubic_feet: Math.round(calculationResults.totalCubicFeet),
            total_weight: Math.round(calculationResults.totalWeight),
            truck_size: calculationResults.truckSize,
            crew_size: calculationResults.numMovers,
            labor_hours: calculationResults.totalHours.toFixed(1)
        },
        cost_breakdown: {
            labor: Math.round(calculationResults.laborCost),
            truck: calculationResults.truckFee,
            truck_equipment: calculationResults.truckEquipmentFee,
            fuel_surcharge: Math.round(calculationResults.fuelSurcharge),
            distance_fee: Math.round(calculationResults.distanceCost),
            optional_fees: Math.round(calculationResults.optionalFees),
            total_low: Math.round(calculationResults.costLow),
            total_high: Math.round(calculationResults.costHigh)
        },
        inventory: webhookConfig.include_inventory_list ? getInventoryList() : null
    };

    try {
        const response = await fetch(webhookConfig.url, {
            method: webhookConfig.method || 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        });

        if (response.ok) {
            console.log('‚úÖ Lead sent to webhook successfully');
        } else {
            console.error('‚ùå Webhook error:', response.status);
        }
    } catch (error) {
        console.error('‚ùå Error sending to webhook:', error);
    }
}

function getInventoryList() {
    const items = [];
    Object.entries(selectedItems).forEach(([itemKey, quantity]) => {
        if (quantity > 0) {
            const [categoryKey, itemName] = itemKey.split('_');
            const item = inventory.categories[categoryKey]?.items[itemName];
            if (item) {
                items.push({
                    name: item.name,
                    quantity: quantity,
                    weight: item.weight
                });
            }
        }
    });
    return items;
}

// ============================================
// PDF EXPORT
// ============================================

function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Header
    doc.setFontSize(20);
    doc.setTextColor(59, 130, 246);
    doc.text('Moving Cost Quote', 20, 20);

    doc.setFontSize(10);
    doc.setTextColor(100);
    doc.text(`Prepared for: ${leadData.name}`, 20, 30);
    doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 35);

    // Cost Summary
    doc.setFontSize(16);
    doc.setTextColor(0);
    doc.text('Estimated Cost', 20, 50);

    doc.setFontSize(14);
    doc.setTextColor(16, 185, 129);
    doc.text(`$${Math.round(calculationResults.costLow).toLocaleString()} - $${Math.round(calculationResults.costHigh).toLocaleString()}`, 20, 58);

    // Breakdown
    let y = 75;
    doc.setFontSize(12);
    doc.setTextColor(0);
    doc.text('Cost Breakdown:', 20, y);

    y += 10;
    doc.setFontSize(10);
    Object.entries(calculationResults.breakdown).forEach(([item, data]) => {
        doc.text(`${item}:`, 25, y);
        doc.text(`$${Math.round(data.amount).toLocaleString()}`, 150, y);
        doc.setTextColor(100);
        doc.text(data.detail, 25, y + 5);
        doc.setTextColor(0);
        y += 12;
    });

    // Move Details
    y += 10;
    doc.setFontSize(12);
    doc.text('Move Details:', 20, y);

    y += 10;
    doc.setFontSize(10);
    doc.text(`Weight: ${Math.round(calculationResults.totalWeight).toLocaleString()} lbs`, 25, y);
    y += 7;
    doc.text(`Volume: ${Math.round(calculationResults.totalCubicFeet)} cu ft`, 25, y);
    y += 7;
    doc.text(`Distance: ${calculationResults.distance} miles`, 25, y);
    y += 7;
    doc.text(`Crew: ${calculationResults.numMovers} movers`, 25, y);
    y += 7;
    doc.text(`Time: ${calculationResults.totalHours.toFixed(1)} hours`, 25, y);
    y += 7;
    doc.text(`Truck: ${calculationResults.truckSize}`, 25, y);

    // Footer
    doc.setFontSize(8);
    doc.setTextColor(150);
    doc.text('This is an estimate. Final cost may vary based on actual conditions.', 20, 280);

    // Save
    doc.save(`moving-quote-${leadData.name.replace(/\s/g, '-')}.pdf`);

    console.log('‚úÖ PDF downloaded');
}

// ============================================
// EMAIL & SMS
// ============================================

function emailQuote() {
    const subject = encodeURIComponent('Your Moving Cost Quote');
    const body = encodeURIComponent(`
Hi ${leadData.name},

Here's your moving cost estimate:

Estimated Cost: $${Math.round(calculationResults.costLow).toLocaleString()} - $${Math.round(calculationResults.costHigh).toLocaleString()}

Move Details:
- Weight: ${Math.round(calculationResults.totalWeight).toLocaleString()} lbs
- Distance: ${calculationResults.distance} miles
- Crew: ${calculationResults.numMovers} movers
- Truck: ${calculationResults.truckSize}
- Time: ${calculationResults.totalHours.toFixed(1)} hours

Thank you for your interest!
    `);

    window.location.href = `mailto:${leadData.email}?subject=${subject}&body=${body}`;
}

function textQuote() {
    alert('SMS integration requires Twilio credentials in config.json');
    // In production, this would send via Twilio API
}

// ============================================
// UTILITY FUNCTIONS
// ============================================

function startOver() {
    if (confirm('Start a new quote? This will clear all current data.')) {
        selectedItems = {};
        calculationResults = null;
        leadData = null;
        window.aiEstimation = null;

        document.getElementById('aiInput').value = '';
        document.getElementById('leadCaptureForm').reset();

        renderInventoryCategories();
        updateInventorySummary();

        document.getElementById('moveDetailsSection').style.display = 'none';
        document.getElementById('partialResults').style.display = 'none';
        document.getElementById('fullResults').style.display = 'none';
        document.getElementById('aiParsedResults').style.display = 'none';

        updateProgress(1);

        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

function updateProgress(step) {
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');

    const steps = {
        1: { width: 33, text: 'Step 1 of 3: Select Items' },
        2: { width: 66, text: 'Step 2 of 3: Move Details' },
        3: { width: 100, text: 'Step 3 of 3: Get Quote' }
    };

    if (steps[step]) {
        progressFill.style.width = `${steps[step].width}%`;
        progressText.textContent = steps[step].text;
    }
}

function showLoading() {
    document.getElementById('loadingOverlay').style.display = 'flex';
}

function hideLoading() {
    document.getElementById('loadingOverlay').style.display = 'none';
}

// ============================================
// DARK MODE
// ============================================

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
}

function loadDarkModePreference() {
    const darkMode = localStorage.getItem('darkMode');
    const defaultDark = config.ui_settings?.theme?.default_dark_mode;

    if (darkMode === 'enabled' || (darkMode === null && defaultDark)) {
        document.body.classList.add('dark-mode');
    }
}

// ============================================
// NEW FEATURES - DYNAMIC PRICING & ADD-ONS
// ============================================

// State for add-ons
let selectedAddOns = {};
let addOnsTotalCost = 0;

// Initialize social proof
function initializeSocialProof() {
    const socialProof = config.social_proof;
    if (!socialProof?.enabled) return;

    const banner = document.getElementById('socialProofBanner');
    if (!banner) return;

    // Set stats
    document.getElementById('avgRating').textContent = socialProof.average_rating;
    document.getElementById('totalReviews').textContent = socialProof.total_reviews.toLocaleString();
    document.getElementById('totalCustomers').textContent = socialProof.total_customers_this_month.toLocaleString();

    // Add trust badges
    const badgesContainer = document.getElementById('trustBadges');
    badgesContainer.innerHTML = socialProof.trust_badges.map(badge =>
        `<span class="trust-badge">${badge}</span>`
    ).join('');

    // Show recent booking animation
    if (socialProof.recent_bookings?.length > 0) {
        let currentIndex = 0;
        const showBooking = () => {
            const booking = socialProof.recent_bookings[currentIndex];
            const bookingEl = document.getElementById('recentBooking');
            bookingEl.textContent = `${booking.name} from ${booking.location} just got a quote ${booking.minutes_ago} minutes ago`;
            currentIndex = (currentIndex + 1) % socialProof.recent_bookings.length;
        };
        showBooking();
        setInterval(showBooking, 8000);
    }

    banner.style.display = 'block';
}

// Calculate dynamic pricing multiplier
function calculateDynamicPricingMultiplier(moveDate = new Date()) {
    const dynamicPricing = config.pricing?.dynamic_pricing;
    if (!dynamicPricing?.enabled) return { multiplier: 1, reasons: [] };

    let multiplier = 1;
    const reasons = [];

    // Peak season
    if (dynamicPricing.peak_season?.enabled) {
        const month = moveDate.getMonth() + 1; // 0-indexed
        if (dynamicPricing.peak_season.months.includes(month)) {
            multiplier *= dynamicPricing.peak_season.multiplier;
            reasons.push(dynamicPricing.peak_season.description);
        }
    }

    // Weekend pricing
    if (dynamicPricing.weekend_pricing?.enabled) {
        const day = moveDate.getDay();
        if (dynamicPricing.weekend_pricing.days.includes(day)) {
            multiplier *= dynamicPricing.weekend_pricing.multiplier;
            reasons.push(dynamicPricing.weekend_pricing.description);
        }
    }

    // Month end
    if (dynamicPricing.month_end?.enabled) {
        const date = moveDate.getDate();
        if (dynamicPricing.month_end.days.includes(date)) {
            multiplier *= dynamicPricing.month_end.multiplier;
            reasons.push(dynamicPricing.month_end.description);
        }
    }

    return { multiplier, reasons };
}

// Calculate add-ons
function calculateAddOns() {
    const addOnsConfig = config.pricing?.add_on_services;
    if (!addOnsConfig) return 0;

    let total = 0;

    // Packing materials (auto-calculate based on weight)
    if (selectedAddOns.packing_materials && addOnsConfig.packing_materials?.enabled) {
        const weight = getTotalWeight() || window.aiEstimation?.weight || 0;
        const bedrooms = Math.max(1, Math.floor(weight / 2000)); // Rough estimate
        const packingItems = addOnsConfig.packing_materials.items;

        Object.values(packingItems).forEach(item => {
            if (item.per_bedroom) {
                total += item.price * item.per_bedroom * bedrooms;
            } else if (item.per_move) {
                total += item.price * item.per_move;
            }
        });

        document.getElementById('packingPrice').textContent = `$${Math.round(total)}`;
    }

    // Insurance
    if (selectedAddOns.insurance && addOnsConfig.insurance?.enabled) {
        const weight = getTotalWeight() || window.aiEstimation?.weight || 0;
        const level = document.getElementById('insuranceLevel').value;
        const option = addOnsConfig.insurance.options.find(o => o.level === level);

        if (option) {
            if (option.rate_per_pound) {
                const insuranceCost = weight * option.rate_per_pound;
                total += insuranceCost;
                document.getElementById('insurancePrice').textContent = `$${Math.round(insuranceCost)}`;
            } else if (option.base_price) {
                total += option.base_price;
                document.getElementById('insurancePrice').textContent = `$${option.base_price}`;
            }
        }
    }

    // Assembly
    if (selectedAddOns.assembly && addOnsConfig.assembly?.enabled) {
        const items = parseInt(document.getElementById('assemblyItems').value) || 0;
        total += items * addOnsConfig.assembly.price_per_item;
    }

    // Storage (first month free)
    if (selectedAddOns.storage && addOnsConfig.storage?.enabled) {
        total += addOnsConfig.storage.first_month_price;
    }

    // Junk removal
    if (selectedAddOns.junk && addOnsConfig.junk_removal?.enabled) {
        const items = parseInt(document.getElementById('junkItems').value) || 0;
        total += items * addOnsConfig.junk_removal.price_per_item;
    }

    // Cleaning
    if (selectedAddOns.cleaning && addOnsConfig.cleaning?.enabled) {
        const weight = getTotalWeight() || window.aiEstimation?.weight || 0;
        const bedrooms = Math.floor(weight / 2000);

        if (bedrooms <= 1) total += addOnsConfig.cleaning.studio_1br;
        else if (bedrooms === 2) total += addOnsConfig.cleaning['2br'];
        else if (bedrooms === 3) total += addOnsConfig.cleaning['3br'];
        else total += addOnsConfig.cleaning['4br_plus'];

        document.getElementById('cleaningPrice').textContent = `$${total}`;
    }

    addOnsTotalCost = total;

    // Update total display
    if (total > 0) {
        document.getElementById('addOnsTotal').style.display = 'block';
        document.getElementById('addOnsTotalAmount').textContent = `$${Math.round(total)}`;
    } else {
        document.getElementById('addOnsTotal').style.display = 'none';
    }

    return total;
}

// Setup add-on event listeners
function setupAddOnListeners() {
    // Show add-ons section when move details are filled
    document.getElementById('moveDetailsSection').addEventListener('input', () => {
        const addOnsSection = document.getElementById('addOnsSection');
        if (config.ui_settings?.features?.enable_add_on_services !== false) {
            addOnsSection.style.display = 'block';
        }
    });

    // Add-on checkboxes
    ['packing', 'insurance', 'assembly', 'storage', 'junk', 'cleaning'].forEach(addon => {
        const checkbox = document.getElementById(`addon_${addon}`);
        if (!checkbox) return;

        checkbox.addEventListener('change', (e) => {
            selectedAddOns[addon === 'packing' ? 'packing_materials' : addon] = e.target.checked;

            // Show/hide additional inputs
            if (addon === 'insurance') {
                document.getElementById('insuranceLevel').style.display = e.target.checked ? 'block' : 'none';
            } else if (addon === 'assembly') {
                document.getElementById('assemblyItems').style.display = e.target.checked ? 'block' : 'none';
            } else if (addon === 'junk') {
                document.getElementById('junkItems').style.display = e.target.checked ? 'block' : 'none';
            }

            calculateAddOns();
        });
    });

    // Input changes for quantity-based add-ons
    ['assemblyItems', 'junkItems', 'insuranceLevel'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('change', calculateAddOns);
    });
}

// Show competitor comparison
function showCompetitorComparison(ourPrice) {
    const compConfig = config.competitor_comparison;
    if (!compConfig?.enabled) return;

    const industryAverage = ourPrice * compConfig.industry_average_multiplier;
    const savings = industryAverage - ourPrice;

    document.getElementById('ourQuote').textContent = `$${Math.round(ourPrice).toLocaleString()}`;
    document.getElementById('competitorQuote').textContent = `$${Math.round(industryAverage).toLocaleString()}`;
    document.getElementById('savingsAmount').textContent = `$${Math.round(savings).toLocaleString()}`;
    document.getElementById('competitorComparison').style.display = 'block';
}

// Show tip calculator
function showTipCalculator(laborCost) {
    const tipConfig = config.tip_calculator;
    if (!tipConfig?.enabled) return;

    const tip15 = laborCost * (tipConfig.suggested_percentage_low / 100);
    const tip18 = laborCost * 0.18;
    const tip20 = laborCost * (tipConfig.suggested_percentage_high / 100);

    document.getElementById('tip15').textContent = `$${Math.round(tip15)}`;
    document.getElementById('tip18').textContent = `$${Math.round(tip18)}`;
    document.getElementById('tip20').textContent = `$${Math.round(tip20)}`;
    document.getElementById('tipCalculator').style.display = 'block';
}

// Generate referral code
function generateReferralCode() {
    const refConfig = config.referral_program;
    if (!refConfig?.enabled) return;

    const code = `${refConfig.code_prefix}${Math.random().toString(36).substring(2, 9).toUpperCase()}`;
    document.getElementById('referralCode').textContent = code;
    document.getElementById('referralSection').style.display = 'block';

    // Copy button
    document.getElementById('copyReferralBtn')?.addEventListener('click', () => {
        navigator.clipboard.writeText(code);
        alert('Referral code copied to clipboard!');
    });
}

// Show dynamic pricing notice
function showDynamicPricingNotice(reasons) {
    if (reasons.length === 0) return;

    const notice = reasons.join(' + ');
    document.getElementById('pricingAlertText').textContent = `‚ö° ${notice} - Limited availability!`;
    document.getElementById('dynamicPricingNotice').style.display = 'block';
}

// Download moving checklist
function downloadMovingChecklist() {
    const checklistConfig = config.moving_checklist;
    if (!checklistConfig?.enabled) return;

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFontSize(20);
    doc.setTextColor(59, 130, 246);
    doc.text('Your Moving Checklist', 20, 20);

    doc.setFontSize(10);
    doc.setTextColor(100);
    doc.text(`Prepared for: ${leadData?.name || 'Valued Customer'}`, 20, 30);

    let y = 45;
    doc.setFontSize(12);
    doc.setTextColor(0);

    checklistConfig.items.forEach((item, index) => {
        if (y > 270) {
            doc.addPage();
            y = 20;
        }

        let timeframe;
        if (item.weeks_before) timeframe = `${item.weeks_before} weeks before`;
        else if (item.days_before) timeframe = `${item.days_before} days before`;
        else timeframe = 'Moving Day';

        doc.setFont(undefined, 'bold');
        doc.text(`‚ñ° ${timeframe}:`, 20, y);
        doc.setFont(undefined, 'normal');
        doc.text(item.task, 30, y + 5);

        y += 15;
    });

    doc.save('moving-checklist.pdf');
}

// Setup feature event listeners
function setupFeatureListeners() {
    document.getElementById('downloadChecklistBtn')?.addEventListener('click', downloadMovingChecklist);

    // Show checklist after full results
    if (config.moving_checklist?.enabled) {
        document.getElementById('checklistSection').style.display = 'block';
    }
}

// Initialize all new features
document.addEventListener('DOMContentLoaded', () => {
    initializeSocialProof();
    setupAddOnListeners();
    setupFeatureListeners();
    setupAdvancedFeatures();
});

// ============================================
// ADVANCED FEATURES - NEW IMPLEMENTATION
// ============================================

// State for selected tier and move date
let selectedTier = 'standard';
let selectedMoveDate = null;
let moveRiskScore = 0;

// Setup advanced features
function setupAdvancedFeatures() {
    // Booking buttons
    setupBookingButtons();

    // Three-tier pricing listeners
    setupTierPricingListeners();

    // Crew availability calendar listeners
    setupCrewAvailability();

    // SMS quote (if enabled)
    if (config.integrations?.sms?.enabled) {
        document.getElementById('textQuoteBtn').style.display = 'inline-block';
    }
}

// ============================================
// BOOKING & CALL OFFICE INTEGRATION
// ============================================

function setupBookingButtons() {
    const bookingConfig = config.booking;
    if (!bookingConfig?.enabled) return;

    // Show buttons
    if (bookingConfig.show_book_button) {
        const bookBtn = document.getElementById('bookNowBtn');
        bookBtn.style.display = 'inline-block';

        // Set button text based on urgency
        const daysUntilMove = selectedMoveDate ? getDaysUntilDate(selectedMoveDate) : null;
        const buttonText = (daysUntilMove && daysUntilMove < 10)
            ? bookingConfig.cta_text_urgent
            : bookingConfig.cta_text_normal;

        document.getElementById('bookNowText').textContent = buttonText;

        // Click handler
        bookBtn.addEventListener('click', () => {
            if (bookingConfig.book_now_url) {
                window.open(bookingConfig.book_now_url, '_blank');
            } else {
                alert('Please contact us to book your move!');
            }
        });
    }

    if (bookingConfig.show_call_button) {
        const callBtn = document.getElementById('callOfficeBtn');
        callBtn.style.display = 'inline-block';
        document.getElementById('officePhone').textContent = bookingConfig.phone || config.company.phone;

        // Click-to-call
        callBtn.addEventListener('click', () => {
            window.location.href = `tel:${bookingConfig.phone.replace(/[^\d]/g, '')}`;
        });
    }
}

function getDaysUntilDate(dateString) {
    const moveDate = new Date(dateString);
    const today = new Date();
    const diffTime = moveDate - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    return diffDays;
}

// ============================================
// AI-GENERATED SUMMARY
// ============================================

function generateAISummary(results) {
    if (!results) return;

    const { totalWeight, distance, numMovers, truckSize, totalHours, costLow, costHigh } = results;

    // Generate natural language summary
    const avgCost = Math.round((costLow + costHigh) / 2);
    const truckName = truckSize.toLowerCase();
    const timeDesc = totalHours < 4 ? 'quick' : totalHours < 8 ? 'half-day' : 'full-day';

    const summary = `Your move requires a ${truckName}, ${numMovers} professional ${numMovers === 1 ? 'mover' : 'movers'}, and will take approximately ${totalHours.toFixed(1)} hours. This is a ${timeDesc} move covering ${distance} miles with ${Math.round(totalWeight).toLocaleString()} lbs of belongings. Your total cost will be between $${Math.round(costLow).toLocaleString()} and $${Math.round(costHigh).toLocaleString()}, with an average of $${avgCost.toLocaleString()}.`;

    // Show in partial results
    document.getElementById('aiSummaryText').textContent = summary;
    document.getElementById('aiSummarySection').style.display = 'block';

    // Show in full results
    const fullSummary = `${summary} We've analyzed your move and prepared a detailed breakdown below. ${results.dynamicPricingReasons?.length > 0 ? 'Note: ' + results.dynamicPricingReasons.join(', ') + '.' : ''}`;
    document.getElementById('aiSummaryFullText').textContent = fullSummary;
    document.getElementById('aiSummaryFull').style.display = 'block';
}

// ============================================
// MOVE RISK SCORE
// ============================================

function calculateMoveRiskScore(results) {
    const riskConfig = config.move_risk_score;
    if (!riskConfig?.enabled) return;

    const { totalWeight, distance, stairs, totalCubicFeet } = results;
    let score = 0;

    // Weight factor
    if (totalWeight > riskConfig.factors.weight_threshold_high) {
        score += 30;
    } else if (totalWeight > 5000) {
        score += 15;
    }

    // Distance factor
    if (distance > riskConfig.factors.long_distance_threshold) {
        score += 25;
    } else if (distance > 50) {
        score += 10;
    }

    // Stairs factor
    if (stairs >= riskConfig.factors.stairs_high_risk) {
        score += 20;
    } else if (stairs > 0) {
        score += 10;
    }

    // Complexity factor (large volume)
    if (totalCubicFeet > 1200) {
        score += 15;
    }

    // Check if packing service not selected
    if (!document.getElementById('packingService').checked && getTotalItems() > 30) {
        score += 10;
    }

    moveRiskScore = score;

    // Determine risk level
    let riskLevel = 'low';
    if (score > riskConfig.risk_levels.medium.max_score) {
        riskLevel = 'high';
    } else if (score > riskConfig.risk_levels.low.max_score) {
        riskLevel = 'medium';
    }

    const levelConfig = riskConfig.risk_levels[riskLevel];

    // Display risk score
    document.getElementById('riskIcon').textContent = levelConfig.icon;
    document.getElementById('riskLabel').textContent = levelConfig.label;
    document.getElementById('riskLabel').style.color = levelConfig.color;
    document.getElementById('riskMessage').textContent = levelConfig.message;
    document.getElementById('riskScoreBadge').style.display = 'block';
}

// ============================================
// THREE-TIER PRICING
// ============================================

function setupTierPricingListeners() {
    document.querySelectorAll('.btn-tier').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const tier = e.target.dataset.tier;
            selectPricingTier(tier);
        });
    });
}

function displayThreeTierPricing(baseResults) {
    const tierConfig = config.three_tier_pricing;
    if (!tierConfig?.enabled) return;

    const tiers = tierConfig.tiers;

    // Calculate prices for each tier
    Object.keys(tiers).forEach(tierKey => {
        const tier = tiers[tierKey];
        const multiplier = tier.multiplier;

        const tierLow = baseResults.costLow * multiplier;
        const tierHigh = baseResults.costHigh * multiplier;
        const tierAvg = (tierLow + tierHigh) / 2;

        // Update prices
        const tierKeyFormatted = tierKey.replace('_', '');
        const capitalizedKey = tierKeyFormatted.charAt(0).toUpperCase() + tierKeyFormatted.slice(1);

        document.getElementById(`price${capitalizedKey}`).textContent = `$${Math.round(tierAvg).toLocaleString()}`;
        document.getElementById(`price${capitalizedKey}Range`).textContent =
            `$${Math.round(tierLow).toLocaleString()} - $${Math.round(tierHigh).toLocaleString()}`;

        // Populate features
        const featuresList = document.getElementById(`features${capitalizedKey}`);
        featuresList.innerHTML = tier.features.map(feature => `<li>${feature}</li>`).join('');
    });

    // Show three-tier pricing
    document.getElementById('threeTierPricing').style.display = 'block';

    // Auto-select standard tier
    selectPricingTier('standard');
}

function selectPricingTier(tier) {
    selectedTier = tier;

    // Remove all selected classes
    document.querySelectorAll('.pricing-tier').forEach(t => t.classList.remove('tier-selected'));

    // Add selected class
    const tierElement = document.querySelector(`[data-tier="${tier}"]`).closest('.pricing-tier');
    if (tierElement) {
        tierElement.classList.add('tier-selected');
    }

    // Update selected tier name
    const tierName = config.three_tier_pricing.tiers[tier]?.name || 'Standard';
    document.getElementById('selectedTierName').textContent = tierName;

    // Recalculate final costs
    updateFinalCostsWithTier();
}

function updateFinalCostsWithTier() {
    if (!calculationResults) return;

    const multiplier = config.three_tier_pricing?.tiers[selectedTier]?.multiplier || 1.0;
    const finalLow = calculationResults.costLow * multiplier;
    const finalHigh = calculationResults.costHigh * multiplier;

    document.getElementById('finalCostLow').textContent = `$${Math.round(finalLow).toLocaleString()}`;
    document.getElementById('finalCostHigh').textContent = `$${Math.round(finalHigh).toLocaleString()}`;
}

// ============================================
// ENHANCED AI MODE - AUTO-FILL INVENTORY
// ============================================

function enhancedAIAutoFill(homeSize) {
    const aiConfig = config.ai_enhanced;
    if (!aiConfig?.enabled || !aiConfig?.auto_fill_inventory) return;

    const inventoryList = aiConfig.home_type_inventory[homeSize];
    if (!inventoryList) return;

    // Clear existing selections
    selectedItems = {};

    // Auto-fill inventory
    inventoryList.forEach(itemSpec => {
        const parts = itemSpec.split(':');
        const itemKey = parts[0];
        const quantity = parts.length > 1 ? parseInt(parts[1]) : 1;

        // Find the item in inventory
        Object.entries(inventory.categories).forEach(([categoryKey, category]) => {
            if (category.items[itemKey]) {
                const fullKey = `${categoryKey}_${itemKey}`;
                selectedItems[fullKey] = quantity;
            }
        });
    });

    // Re-render inventory to show selections
    renderInventoryCategories();
    updateInventorySummary();

    // Show move details section
    document.getElementById('moveDetailsSection').style.display = 'block';
    updateProgress(2);

    console.log(`‚úÖ Auto-filled ${Object.keys(selectedItems).length} items for ${homeSize}`);
}

// Update parseAIInput to use enhanced auto-fill
function parseAIInputEnhanced(input) {
    const parsed = parseAIInput(input); // Use existing logic

    // If home size detected, auto-fill inventory
    if (parsed.homeSize && config.ai_enhanced?.auto_fill_inventory) {
        enhancedAIAutoFill(parsed.homeSize);
    }

    return parsed;
}

// ============================================
// CREW AVAILABILITY CALENDAR
// ============================================

function setupCrewAvailability() {
    const crewConfig = config.crew_availability;
    if (!crewConfig?.enabled) return;

    // Generate calendar
    renderCrewAvailabilityCalendar();

    // Show calendar in partial results
    document.getElementById('crewAvailability').style.display = 'block';
}

function renderCrewAvailabilityCalendar() {
    const crewConfig = config.crew_availability;
    if (!crewConfig?.show_calendar) return;

    const calendar = document.getElementById('availabilityCalendar');
    const availableDates = crewConfig.available_dates || [];
    const limitedDates = crewConfig.limited_availability_dates || [];

    calendar.innerHTML = availableDates.map(dateStr => {
        const date = new Date(dateStr);
        const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
        const dayNum = date.getDate();
        const monthName = date.toLocaleDateString('en-US', { month: 'short' });

        const isLimited = limitedDates.includes(dateStr);
        const className = isLimited ? 'limited' : 'available';

        return `
            <div class="availability-date ${className}" data-date="${dateStr}">
                <span class="date-label">${dayName}, ${monthName}</span>
                <span class="date-number">${dayNum}</span>
            </div>
        `;
    }).join('');

    // Add click handlers
    document.querySelectorAll('.availability-date').forEach(dateEl => {
        dateEl.addEventListener('click', () => {
            // Remove previous selection
            document.querySelectorAll('.availability-date').forEach(d => d.classList.remove('selected'));

            // Select this date
            dateEl.classList.add('selected');
            selectedMoveDate = dateEl.dataset.date;

            // Update booking button text based on urgency
            setupBookingButtons();
        });
    });
}

// ============================================
// SMART UPSELL ENGINE
// ============================================

function generateSmartUpsells(results) {
    const upsellConfig = config.smart_upsells;
    if (!upsellConfig?.enabled) return;

    const upsells = [];
    const rules = upsellConfig.rules;

    // Extra mover recommendation
    if (rules.extra_mover?.enabled) {
        const weight = results.totalWeight;
        if (weight >= rules.extra_mover.trigger_weight_min && weight <= rules.extra_mover.trigger_weight_max) {
            upsells.push({
                icon: 'üë∑',
                title: 'Add Extra Mover',
                message: rules.extra_mover.message,
                benefit: rules.extra_mover.benefit,
                action: 'Upgrade Crew'
            });
        }
    }

    // Protection materials
    if (rules.protection_materials?.enabled && !selectedAddOns.packing_materials) {
        const hasFragileItems = checkForFragileItems();
        if (hasFragileItems) {
            upsells.push({
                icon: 'üõ°Ô∏è',
                title: 'Protection Materials',
                message: rules.protection_materials.message,
                benefit: rules.protection_materials.benefit,
                action: 'Add Protection'
            });
        }
    }

    // Packing service
    if (rules.packing_service?.enabled) {
        const itemCount = getTotalItems();
        if (itemCount >= rules.packing_service.trigger_item_count && !document.getElementById('packingService').checked) {
            upsells.push({
                icon: 'üì¶',
                title: 'Professional Packing',
                message: rules.packing_service.message,
                benefit: rules.packing_service.benefit,
                action: 'Add Packing Service'
            });
        }
    }

    // Insurance upgrade
    if (rules.insurance_upgrade?.enabled && !selectedAddOns.insurance) {
        const estimatedValue = results.totalWeight * 5; // Rough estimate $5/lb
        if (estimatedValue >= rules.insurance_upgrade.trigger_value_estimate) {
            upsells.push({
                icon: 'üîí',
                title: 'Full Insurance Coverage',
                message: rules.insurance_upgrade.message,
                benefit: rules.insurance_upgrade.benefit,
                action: 'Add Insurance'
            });
        }
    }

    // White glove recommendation
    if (rules.white_glove_recommendation?.enabled) {
        if (moveRiskScore >= rules.white_glove_recommendation.trigger_risk_score) {
            upsells.push({
                icon: '‚≠ê',
                title: 'White Glove Service',
                message: rules.white_glove_recommendation.message,
                benefit: rules.white_glove_recommendation.benefit,
                action: 'Upgrade to White Glove'
            });
        }
    }

    // Display upsells
    if (upsells.length > 0) {
        displayUpsells(upsells);
    }
}

function checkForFragileItems() {
    const fragileKeywords = config.smart_upsells?.rules?.protection_materials?.fragile_item_keywords || [];

    for (const [itemKey, quantity] of Object.entries(selectedItems)) {
        if (quantity > 0) {
            const itemName = itemKey.toLowerCase();
            if (fragileKeywords.some(keyword => itemName.includes(keyword))) {
                return true;
            }
        }
    }
    return false;
}

function displayUpsells(upsells) {
    const container = document.getElementById('upsellCards');

    container.innerHTML = upsells.map(upsell => `
        <div class="upsell-card">
            <div class="upsell-header">
                <span class="upsell-icon">${upsell.icon}</span>
                <h4 class="upsell-title">${upsell.title}</h4>
            </div>
            <p class="upsell-message">${upsell.message}</p>
            <p class="upsell-benefit">‚úì ${upsell.benefit}</p>
        </div>
    `).join('');

    document.getElementById('upsellSection').style.display = 'block';
}

// ============================================
// SMS QUOTE DELIVERY
// ============================================

function textQuoteEnhanced() {
    const smsConfig = config.integrations?.sms;

    if (!smsConfig?.enabled || !smsConfig?.twilio_account_sid) {
        alert('SMS integration requires Twilio credentials in config.json. Contact your administrator to enable this feature.');
        return;
    }

    // In production, this would call Twilio API
    const phoneNumber = leadData.phone || prompt('Enter phone number to receive quote:');

    if (phoneNumber) {
        alert(`Quote will be sent to ${phoneNumber} via SMS. (In production, this would use Twilio API)`);
        console.log('SMS quote requested for:', phoneNumber);
    }
}

// Override existing textQuote function
window.textQuote = textQuoteEnhanced;

// ============================================
// INTEGRATION WITH EXISTING CALCULATION FLOW
// ============================================

// Override displayPartialResults to include new features
const originalDisplayPartialResults = displayPartialResults;
function displayPartialResults() {
    // Call original function
    if (typeof originalDisplayPartialResults === 'function') {
        originalDisplayPartialResults();
    }

    // Add new features
    generateAISummary(calculationResults);
    calculateMoveRiskScore(calculationResults);
    generateSmartUpsells(calculationResults);
}

// Override displayFullResults to include new features
const originalDisplayFullResults = displayFullResults;
function displayFullResults() {
    // Call original function first
    if (typeof originalDisplayFullResults === 'function') {
        originalDisplayFullResults();
    }

    // Add three-tier pricing
    displayThreeTierPricing(calculationResults);

    // Show booking buttons
    setupBookingButtons();
}

// ============================================
// CONSOLE BANNER
// ============================================

console.log('%cüöö Moving Cost Calculator', 'color: #3b82f6; font-size: 20px; font-weight: bold;');
console.log('%cPowered by RoutineMoves', 'color: #10b981; font-size: 12px;');
console.log('%cAdd ?admin=true to URL for admin mode', 'color: #666; font-size: 10px;');
console.log('%c‚ú® Advanced Features Enabled', 'color: #f59e0b; font-size: 10px; font-weight: bold;');
    </script>
</body>
</html>
